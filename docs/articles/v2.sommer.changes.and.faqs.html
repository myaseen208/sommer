<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Changes and FAQs for the sommer package • sommer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Changes and FAQs for the sommer package">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Changes and FAQs for the sommer package</h1>
                        <h4 data-toc-skip class="author">Giovanny
Covarrubias-Pazaran</h4>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/covaruber/sommer/blob/HEAD/vignettes/v2.sommer.changes.and.faqs.Rmd"><code>vignettes/v2.sommer.changes.and.faqs.Rmd</code></a></small>
      <div class="d-none name"><code>v2.sommer.changes.and.faqs.Rmd</code></div>
    </div>

    
    
<p>The sommer package was developed to provide R users with a powerful
and reliable multivariate mixed model solver. The package is focused on
two approaches: 1) p &gt; n (more effects to estimate than observations)
using the mmer() function, and 2) n &gt; p (more observations than
effects to estimate) using the mmec() function. The core algorithms are
coded in C++ using the Armadillo library. This package allows the user
to specify the variance-covariance structure for the random effects, to
specify heterogeneous variances, and to obtain other parameters such as
BLUPs, BLUEs, residuals, fitted values, variances for fixed and random
effects, etc.</p>
<p>Recently, I decided to code the main algorithm (Newton-Raphson &amp;
Average-Information) in C++ which encouraged me to refactor all the
machinery including special functions and specification of the models.
For a more in depth explanation of how the machinery works please read
the “Quick start for the sommer package” vignette by typing
<code>vignette('sommer.start')</code>. Here I will focus on just making
a translation of the old specification to the new specification.</p>
<p>The purpose of this vignette is to first show the changes in syntax
for <code>sommer</code> and frequently asked question.</p>
<p><strong>SECTION 1: The new syntax of sommer</strong></p>
<ol style="list-style-type: decimal">
<li>The specification of multiresponse model</li>
<li>The specification of multivariate unknown covariance structures</li>
<li>The specification of additional unknown covariance structures</li>
<li>The specification of unknown covariance structures in the
residuals</li>
<li>Special models</li>
</ol>
<p><strong>SECTION 2: Frequently asked questions</strong></p>
<ol style="list-style-type: decimal">
<li>I got an error similar to…</li>
<li>My model runs very slow.</li>
<li>Can I run both rrBLUP for markers and GBLUP for individuals in
sommer?</li>
<li>I am missing BLUPs for individuals even when I provided them in the
relationship matrix.</li>
<li>How can I use the AR1(), CS() and ARMA() functions?</li>
<li>Can I run GWAS in MET experiments with replicates?</li>
<li>How can I constrain the value of specific random effects?</li>
<li>How can I constrain two variance components to be equal?</li>
<li>I get an error when installing directly from github</li>
<li>I get and error when specifying an interaction of the form X:Z</li>
<li>I get the error “contrasts&lt;-<code>(</code><em>tmp</em>`, value =
contr.funs[1 + isOF[nn]])”</li>
<li>I get an error “Error: addition: incompatible matrix dimensions:
n1xn1 and n2xn2”</li>
<li>My model only runs few iterations giving meaningless results</li>
</ol>
<div class="section level2">
<h2 id="section-1-the-new-syntax-of-sommer">SECTION 1: The new syntax of sommer<a class="anchor" aria-label="anchor" href="#section-1-the-new-syntax-of-sommer"></a>
</h2>
<div class="section level3">
<h3 id="the-specification-of-multiresponse-model">1) The specification of multiresponse model<a class="anchor" aria-label="anchor" href="#the-specification-of-multiresponse-model"></a>
</h3>
<p>In past versions (depending how old your version) there was an
argument called <code>MVM</code> which had to be set to TRUE if the user
wanted to run a true multi-trait model since the specification</p>
<p><code>fixed= cbind(y1,y2)~x</code></p>
<p>would by default fit 2 univariate models in parallel. That is no
longer the case, the <code>MVM</code> argument doesn’t exist and if a
model like the one above is specified it will run a true multi-trait
model.</p>
</div>
<div class="section level3">
<h3 id="the-specification-of-multivariate-unknown-covariance-structures">2) The specification of multivariate unknown covariance
structures<a class="anchor" aria-label="anchor" href="#the-specification-of-multivariate-unknown-covariance-structures"></a>
</h3>
<p>In the previous versions when I introduced the multivariate solver I
decided to follow the asreml syntax to specify the unknown covariance
structure that needed to be estimated. For example, a diagonal model for
the multitrait model, assuming a random effect called <code>re</code>
looked something like this:</p>
<p><code>fixed= cbind(y1,y2)~x</code></p>
<p><code>random= ~ diag(trait):re</code></p>
<p>and an unstructured multitrait model was:</p>
<p><code>random= ~ usr(trait):re</code></p>
<p>Although this was easier for users familiar with asreml, it put a lot
of limitations on the way constraints for variance components were
specified. The same model in the new versions looks like this:</p>
<p><code>random= ~ vsr(re, Gtc=unsm(2))</code></p>
<p>where the <code>Gtc</code> argument helps usr to indicate what type
of structure this random effect represents. Here I specified an
unstructured model with the function <code><a href="../reference/unsm.html">unsm()</a></code> with a number 2
for 2 traits. The user can specify either <code><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag()</a></code> or
<code>uncm()</code>, or any customized matrix with dimensions t x t (t
being the number of traits) containing the number 0,1,2,3 that specify
the constraint:</p>
<ul>
<li>0: not to be estimated</li>
<li>1: estimated and constrained to be positive (i.e. variance
component)</li>
<li>2: estimated and unconstrained (can be negative or positive,
i.e. covariance component)</li>
<li>3: not to be estimated but fixed (value has to be provided in the
<code>Gti</code> argument)</li>
</ul>
<p>All these models fit a model with the following variance for
<code>re</code>:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">var(u) = T</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⊗</mi><annotation encoding="application/x-tex">\otimes</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math></p>
<p>where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝐯</mi><mi>𝐚</mi><mi>𝐫</mi><mrow><mo stretchy="true" form="prefix" mathvariant="bold">(</mo><mi>𝐮</mi><mo stretchy="true" form="postfix" mathvariant="bold">)</mo></mrow></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>1</mn><mo>,</mo><mi>t</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>1</mn><mo>,</mo><mi>t</mi><mn>2</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>2</mn><mo>,</mo><mi>t</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>2</mn><mo>,</mo><mi>t</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\mathbf{var(u)} = \left[\begin{array}
{rr}
{\sigma^2_{g_{_{t1,t1}}}} &amp; {\sigma_{g_{_{t1,t2}}}} \\
{\sigma_{g_{_{t2,t1}}}} &amp; {\sigma^2_{g_{_{t2,t2}}}} \\
\end{array}\right] \otimes A
</annotation></semantics></math></p>
<p>By making this change now, the user has full control of the
constraints applied to the estimation of variance components and can
provide initial values easily using the <code>Gti</code> argument.</p>
</div>
<div class="section level3">
<h3 id="the-specification-of-additional-unknown-covariance-structures">3) The specification of additional unknown covariance
structures<a class="anchor" aria-label="anchor" href="#the-specification-of-additional-unknown-covariance-structures"></a>
</h3>
<p>If we focus for a moment on a univariate mixed model we can also have
other unknown covariance structures specified.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">var(u) = E</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>⊗</mi><mi>.</mi><mi>.</mi><mi>.</mi><mo>⊗</mo></mrow><annotation encoding="application/x-tex">\otimes ... \otimes</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⊗</mi><annotation encoding="application/x-tex">\otimes</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math></p>
<p>where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝐯</mi><mi>𝐚</mi><mi>𝐫</mi><mrow><mo stretchy="true" form="prefix" mathvariant="bold">(</mo><mi>𝐮</mi><mo stretchy="true" form="postfix" mathvariant="bold">)</mo></mrow></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>⊗</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>1</mn><mo>,</mo><mi>f</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>1</mn><mo>,</mo><mi>f</mi><mn>2</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>2</mn><mo>,</mo><mi>f</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>2</mn><mo>,</mo><mi>f</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\mathbf{var(u)} = \left[\begin{array}
{rrr}
{\sigma^2_{g_{_{e1,e1}}}} &amp; {\sigma_{g_{_{e1,e2}}}} &amp; {\sigma_{g_{_{e1,e3}}}} \\
{\sigma_{g_{_{e2,e1}}}} &amp; {\sigma^2_{g_{_{e2,e2}}}} &amp; {\sigma_{g_{_{e2,e3}}}} \\
{\sigma_{g_{_{e3,e1}}}} &amp; {\sigma_{g_{_{e3,e2}}}} &amp; {\sigma^2_{g_{_{e3,e3}}}} \\
\end{array}\right] \otimes ... \otimes \left[\begin{array}
{rr}
{\sigma^2_{g_{_{f1,f1}}}} &amp; {\sigma_{g_{_{f1,f2}}}} \\
{\sigma_{g_{_{f2,f1}}}} &amp; {\sigma^2_{g_{_{f2,f2}}}} \\
\end{array}\right] \otimes A
</annotation></semantics></math></p>
<p>If we think about the multi trait model, this is very similar but
with an additional kroneker product for the multivariate version:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">var(u) =T</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⊗</mi><annotation encoding="application/x-tex">\otimes</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>⊗</mi><mi>.</mi><mi>.</mi><mi>.</mi><mo>⊗</mo></mrow><annotation encoding="application/x-tex">\otimes ... \otimes</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⊗</mi><annotation encoding="application/x-tex">\otimes</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math></p>
<p>where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝐯</mi><mi>𝐚</mi><mi>𝐫</mi><mrow><mo stretchy="true" form="prefix" mathvariant="bold">(</mo><mi>𝐮</mi><mo stretchy="true" form="postfix" mathvariant="bold">)</mo></mrow></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>1</mn><mo>,</mo><mi>t</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>1</mn><mo>,</mo><mi>t</mi><mn>2</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>2</mn><mo>,</mo><mi>t</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>2</mn><mo>,</mo><mi>t</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>⊗</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>1</mn><mo>,</mo><mi>f</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>1</mn><mo>,</mo><mi>f</mi><mn>2</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>2</mn><mo>,</mo><mi>f</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>f</mi><mn>2</mn><mo>,</mo><mi>f</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\mathbf{var(u)} = \left[\begin{array}
{rr}
{\sigma^2_{g_{_{t1,t1}}}} &amp; {\sigma_{g_{_{t1,t2}}}} \\
{\sigma_{g_{_{t2,t1}}}} &amp; {\sigma^2_{g_{_{t2,t2}}}} \\
\end{array}\right] \otimes \left[\begin{array}
{rrr}
{\sigma^2_{g_{_{e1,e1}}}} &amp; {\sigma_{g_{_{e1,e2}}}} &amp; {\sigma_{g_{_{e1,e3}}}} \\
{\sigma_{g_{_{e2,e1}}}} &amp; {\sigma^2_{g_{_{e2,e2}}}} &amp; {\sigma_{g_{_{e2,e3}}}} \\
{\sigma_{g_{_{e3,e1}}}} &amp; {\sigma_{g_{_{e3,e2}}}} &amp; {\sigma^2_{g_{_{e3,e3}}}} \\
\end{array}\right] \otimes ... \otimes \left[\begin{array}
{rr}
{\sigma^2_{g_{_{f1,f1}}}} &amp; {\sigma_{g_{_{f1,f2}}}} \\
{\sigma_{g_{_{f2,f1}}}} &amp; {\sigma^2_{g_{_{f2,f2}}}} \\
\end{array}\right] \otimes A
</annotation></semantics></math></p>
<p>Getting back to the point–the additional unknown covariance
structures besides the multi-trait (T) before were specified with asreml
syntax. For example a univariate diagonal and unstructured model,
assumed a random effect called <code>id</code> representing the
treatments planted in different environments coded in a second random
effect called <code>env</code>. The model used to look like:</p>
<p><code>fixed= y1~x</code></p>
<p><code>random= ~ diag(env):id</code> or
<code>random= ~ usr(env):id</code></p>
<p>and now it would be specified as:</p>
<p><code>fixed= y1~x</code></p>
<p><code>random= ~ vsr(dsr(env),id)</code> or
<code>random= ~ vsr(usr(env),id)</code></p>
<p>where the <code><a href="../reference/dsr.html">dsr()</a></code> and <code><a href="../reference/usr.html">usr()</a></code> functions specify
diagonal and unstructured models respectively. Now <code><a href="../reference/csr.html">csr()</a></code>
for a customized structure is available. The main gain from having
changed the formulation is that the new specification through the
<code><a href="../reference/vsr.html">vsr()</a></code> function allows for contructing more complex moels.
For example, assume individuals specified in a column called
<code>id</code> tested in three environments in a column called
<code>env</code> measured at two different time points specified in a
column called <code>time</code>. We may want something more flexible
than:</p>
<p><code>fixed= y1~x</code></p>
<p><code>random= ~ id</code></p>
<p>We could actually assume that individuals are correlated within the
environments for the different time points but want to consider
envrionments indepedent. The variance for such random effects is the
following:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝐯</mi><mi>𝐚</mi><mi>𝐫</mi><mrow><mo stretchy="true" form="prefix" mathvariant="bold">(</mo><mi>𝐮</mi><mo stretchy="true" form="postfix" mathvariant="bold">)</mo></mrow></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>1</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>2</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>2</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>e</mi><mn>3</mn><mo>,</mo><mi>e</mi><mn>3</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>1</mn><mo>,</mo><mi>t</mi><mn>1</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>1</mn><mo>,</mo><mi>t</mi><mn>2</mn></mrow></msub></msub></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>2</mn><mo>,</mo><mi>t</mi><mn>1</mn></mrow></msub></msub></msub></mtd><mtd columnalign="right" style="text-align: right"><msubsup><mi>σ</mi><msub><mi>g</mi><msub><mi></mi><mrow><mi>t</mi><mn>2</mn><mo>,</mo><mi>t</mi><mn>2</mn></mrow></msub></msub><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>⊗</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\mathbf{var(u)} = \left[\begin{array}
{rrr}
{\sigma^2_{g_{_{e1,e1}}}} &amp; {\sigma_{g_{_{e1,e2}}}} &amp; {\sigma_{g_{_{e1,e3}}}} \\
{\sigma_{g_{_{e2,e1}}}} &amp; {\sigma^2_{g_{_{e2,e2}}}} &amp; {\sigma_{g_{_{e2,e3}}}} \\
{\sigma_{g_{_{e3,e1}}}} &amp; {\sigma_{g_{_{e3,e2}}}} &amp; {\sigma^2_{g_{_{e3,e3}}}} \\
\end{array}\right] \otimes \left[\begin{array}
{rr}
{\sigma^2_{g_{_{t1,t1}}}} &amp; {\sigma_{g_{_{t1,t2}}}} \\
{\sigma_{g_{_{t2,t1}}}} &amp; {\sigma^2_{g_{_{t2,t2}}}} \\
\end{array}\right] \otimes A
</annotation></semantics></math> which was not possible in previous
versions of sommer and now can be specified as:</p>
<p><code>random= ~ vsr(usr(env),dsr(time),id)</code></p>
<p>and the same logic can be extended to as many interacting factors as
desired.</p>
</div>
<div class="section level3">
<h3 id="the-specification-of-unknown-covariance-structures-in-the-residuals">4) The specification of unknown covariance structures in the
residuals<a class="anchor" aria-label="anchor" href="#the-specification-of-unknown-covariance-structures-in-the-residuals"></a>
</h3>
<p>Previously, sommer was limited to only diagonal models in the
residuals (unstructured available only for multi-trait before). Now all
the same applications discussed for the random term also apply for the
residual term. Just keep in mind that the residual term is always called
<code>units</code>.</p>
<p>Previous versions:</p>
<p><code>random= ~ diag(trait):diag(env):units</code></p>
<p><code>random= ~ usr(trait):diag(env):units</code> # limit</p>
<p>New versions (&gt;3.7):</p>
<p><code>random= ~ vsr(dsr(env),units, Gtc=mm)</code> ## can be extended
to more interacting factors</p>
<p><code>random= ~ vsr(usr(env),units, Gtc=mm)</code> ## can be extended
to more interacting factors</p>
<p><code>random= ~ vsr(at(env),units, Gtc=mm)</code> ## can be extended
to more interacting factors</p>
<p><code>random= ~ vsr(csr(env),units, Gtc=mm)</code> ## can be extended
to more interacting factors</p>
<p>where <code>mm</code> can be any matrix specifying the type of
multi-trait model (constraints). For example we could use
<code><a href="../reference/unsm.html">unsm()</a></code> <code><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag()</a></code>, <code>uncm()</code> or any
other customized matrix.</p>
</div>
<div class="section level3">
<h3 id="special-models">5) Special models<a class="anchor" aria-label="anchor" href="#special-models"></a>
</h3>
<p>In previous versions the use of asreml formulation really limited the
expansion of sommer to more sophistiated models. Now there are many more
possible models.</p>
<p>Previous versions:</p>
<div class="section level4">
<h4 id="overlay-models">Overlay models<a class="anchor" aria-label="anchor" href="#overlay-models"></a>
</h4>
<p>Previous version: limited to 2 columns and only random and no
covariance structures.</p>
<p><code>random= ~  x + and(y)</code></p>
<p>New versions (&gt;3.7): in theory there are no limits. Can be
extended to more interacting factors in the unknown covariance
structures and can overlay as many columns as needed. Plus is fully
functional with the multivariate models.</p>
<p><code>random=~ vsr(..., overlay(x1,...,xn), Gtc=mm)</code></p>
</div>
<div class="section level4">
<h4 id="random-regression-models">Random regression models<a class="anchor" aria-label="anchor" href="#random-regression-models"></a>
</h4>
<p>Previous version: Not available before</p>
<p>New versions (&gt;3.7): in theory no limits. Can be extended to more
interacting factors in the unknown covariance structures and only
requires the use of the <code><a href="../reference/leg.html">leg()</a></code> function. Plus is fully
functional with the multivariate models.</p>
<p><code>random=~ vsr(usr(leg(v,1)),x)</code></p>
<p><code>random=~ vsr(dsr(leg(v,1)),x)</code></p>
<p><code>random=~ vsr(leg(v,1),x)</code></p>
</div>
<div class="section level4">
<h4 id="gwas-models">GWAS models<a class="anchor" aria-label="anchor" href="#gwas-models"></a>
</h4>
<p>Previous version: Only univariate models available</p>
<p>New versions (&gt;3.7): all the power of the <code><a href="../reference/mmer.html">mmer()</a></code>
function is available plus you can fit multivariate GWAS models. See
details in the sommer.start vignettes.</p>
</div>
<div class="section level4">
<h4 id="spatial-models">Spatial models<a class="anchor" aria-label="anchor" href="#spatial-models"></a>
</h4>
<p>Previous version: It was called directly in the formula</p>
<p><code>random=~ spl2D(Row,Col,at=?)</code></p>
<p>New versions (&gt;3.7): It has to be called within the
<code><a href="../reference/vsr.html">vsr()</a></code> function but now it can be combined with all the
unknown covariance structures available.</p>
<p><code>random=~ vsr(...,spl2D(Row,Col,at=?), Gtc=mm)</code> # being mm
any multi-trait constraint-structure.</p>
</div>
<div class="section level4">
<h4 id="customized-random-effects">Customized random effects<a class="anchor" aria-label="anchor" href="#customized-random-effects"></a>
</h4>
<p>Previous version: It was provided in the grouping argument</p>
<p><code>random=~ grp(x),</code></p>
<p><code>grouping=list(x=Z)</code></p>
<p>New versions (&gt;3.7): It has to be called within the
<code><a href="../reference/vsr.html">vsr()</a></code> function but now it can be combined with all the
unknown covariance structures available.</p>
<p><code>random=~vsr(,..., Z, Gtc=mm)</code> # mm is any multi-trait
constraint-structure.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="section-2-frequently-asked-questions">SECTION 2: Frequently asked questions<a class="anchor" aria-label="anchor" href="#section-2-frequently-asked-questions"></a>
</h2>
<div class="section level3">
<h3 id="i-got-an-error-similar-to">1) I got an error similar to:<a class="anchor" aria-label="anchor" href="#i-got-an-error-similar-to"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># iteration    LogLik     wall    cpu(sec)   restrained</span></span>
<span><span class="co">#     1      -224.676   18:11:23      3           0</span></span>
<span><span class="co"># Sistem is singular. Aborting the job. You could try a bigger tolparinv value.</span></span></code></pre></div>
<p>This error indicates that your model is singular (phenotypic variance
V matrix is not invertible) and therefore the model is stopped, throwing
the error message and returning an empty list. You can try a simpler
model or just modify the argument <code>tolparinv</code> in the
<code><a href="../reference/mmer.html">mmer()</a></code> function. The default is 1e-3, which means that it
will try to invert V and if it fails it will try to add a small value to
the diagonal of V of 1e-3 to make it invertible and try bigger and biger
numbers. If this fails then the program will return the empty list.</p>
<p>Sometimes the model becomes singular when you use variance covariance
matrices (i.e. genomic relationship matrices) that are not full-rank.
You can try to make it full-rank and try again.</p>
</div>
<div class="section level3">
<h3 id="my-model-runs-very-slow">2) My model runs very slow<a class="anchor" aria-label="anchor" href="#my-model-runs-very-slow"></a>
</h3>
<p>Keep in mind that sommer uses direct inversion (DI) algorithm which
can be very slow for large datasets. The package is focused on problems
of the type p &gt; n (more random effect levels than observations) and
models with dense covariance structures. For example, for an experiment
with dense covariance structures with low-replication (i.e. 2000 records
from 1000 individuals replicated twice with a covariance structure of
1000x1000) the direct-inversion used in mmer() will be faster than
MME-based algorithms Also for genomic problems with large number of
random effect levels, i.e. 300 individuals (n) with 100,000 genetic
markers (p). For highly replicated trials with small covariance
structures or n &gt; p (i.e. 2000 records from 200 individuals
replicated 10 times with covariance structure of 200x200) the mmec()
function from sommer or any other MME-based algorithms will be much
faster and we recommend you to opt for those software.</p>
</div>
<div class="section level3">
<h3 id="can-i-run-both-rrblup-for-markers-and-gblup-for-individuals-in-sommer">3) Can I run both; rrBLUP for markers and GBLUP for individuals in
sommer?<a class="anchor" aria-label="anchor" href="#can-i-run-both-rrblup-for-markers-and-gblup-for-individuals-in-sommer"></a>
</h3>
<p>Both types of models can be fitted in sommer. Please see the vignette
#1.</p>
</div>
<div class="section level3">
<h3 id="i-am-missing-blups-for-individuals-even-when-i-provided-them-in-the-relationship-matrix">4) I am missing BLUPs for individuals even when I provided them in
the relationship matrix<a class="anchor" aria-label="anchor" href="#i-am-missing-blups-for-individuals-even-when-i-provided-them-in-the-relationship-matrix"></a>
</h3>
<p>I got this good question in the past: “when I want to fit an animal
model with the sommer package using an additive relationship matrix(A),
this A matrix would contain parents. But the random effects only
contains animals in the random effect but not including parents in the A
matrix. How can I get the random effects for parents?”</p>
<p>Answer: The easy way to do it is to make sure that even if the
parents don’t show up in the dataset, you need to make sure that they
are present in the levels of the column that contains the individuals
(i.e. animal IDs), in addition they have to be provided in the
relationship matrix and that’s it. They should be returned in the
blups.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: MASS</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: crayon</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">GT</span> <span class="op">&lt;-</span> <span class="va">GT_cpdata</span></span>
<span><span class="va">MP</span> <span class="op">&lt;-</span> <span class="va">MP_cpdata</span></span>
<span><span class="co">#### create the variance-covariance matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/A.mat.html">A.mat</a></span><span class="op">(</span><span class="va">GT</span><span class="op">)</span> <span class="co"># additive relationship matrix</span></span>
<span><span class="co">#### look at the data and fit the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">DT2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>,<span class="fl">100</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># we simulate a dataset with only 100 animals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100</span></span></code></pre>
<pre><code><span><span class="co">## [1] 100</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we fit a model with the reduced datatset where only 100 blups will be returned since only</span></span>
<span><span class="co"># 100 levels exist in the "id" column</span></span>
<span><span class="va">mix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">id</span>,Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span></span>
<span>                      <span class="op">+</span> <span class="va">Rowf</span> <span class="op">+</span> <span class="va">Colf</span>,</span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Adding additional levels of Gu in the model matrix of 'id'</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -47.00674 96.01348 98.61865     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                   VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## u:id.Yield-Yield   1531.7    1000.9  1.530   Positive</span></span>
<span><span class="co">## Rowf.Yield-Yield    157.1     297.5  0.528   Positive</span></span>
<span><span class="co">## Colf.Yield-Yield      0.0     396.4  0.000   Positive</span></span>
<span><span class="co">## units.Yield-Yield  3358.4     883.6  3.801   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)    127.4     7.214   17.66</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##      Yield</span></span>
<span><span class="co">## u:id   363</span></span>
<span><span class="co">## Rowf    13</span></span>
<span><span class="co">## Colf    35</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mix1</span><span class="op">$</span><span class="va">U</span><span class="op">$</span><span class="va">`u:id`</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="co"># only 100 levels</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 363</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we add additional levels to the "id" column and also provide them in the relationship matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>             random<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">id</span>,Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span></span>
<span>             <span class="op">+</span> <span class="va">Rowf</span> <span class="op">+</span> <span class="va">Colf</span>,</span>
<span>             rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>             data<span class="op">=</span><span class="va">DT2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -47.00674 96.01348 98.61865     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                   VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## u:id.Yield-Yield   1531.7    1000.9  1.530   Positive</span></span>
<span><span class="co">## Rowf.Yield-Yield    157.1     297.5  0.528   Positive</span></span>
<span><span class="co">## Colf.Yield-Yield      0.0     396.4  0.000   Positive</span></span>
<span><span class="co">## units.Yield-Yield  3358.4     883.6  3.801   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)    127.4     7.214   17.66</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##      Yield</span></span>
<span><span class="co">## u:id   363</span></span>
<span><span class="co">## Rowf    13</span></span>
<span><span class="co">## Colf    35</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mix2</span><span class="op">$</span><span class="va">U</span><span class="op">$</span><span class="va">`u:id`</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="co"># now 363 levels</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 363</span></span></code></pre>
<p>As of 4.1.2 this shouldn’t be a problem since internally the
<code><a href="../reference/mmer.html">mmer()</a></code> solver adds the missing levels, but we leave this
for reference for people using older versions of sommer.</p>
</div>
<div class="section level3">
<h3 id="how-can-i-use-the-ar1-cs-and-arma-functions">5) How can I use the AR1(), CS() and ARMA() functions<a class="anchor" aria-label="anchor" href="#how-can-i-use-the-ar1-cs-and-arma-functions"></a>
</h3>
<p>Sommer doesn’t support the estimation of additional correlation
components like AR1 in the way asreml does. Still, if the user knows the
correlation value or can do an iterative approach to find the best value
then these functions can be used to specify the variance covariance
structure for a given random effect.</p>
<p>For example, in the DT_cpdata dataset we have a field with row and
column coordinates. This allows fitting row and column as random
effects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">mix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span> <span class="va">Rowf</span> <span class="op">+</span> <span class="va">Colf</span>,</span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix1</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                     VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## Rowf.Yield-Yield   832.2879  393.8951  2.112968   Positive</span></span>
<span><span class="co">## Colf.Yield-Yield   153.9201  126.7582  1.214281   Positive</span></span>
<span><span class="co">## units.Yield-Yield 3647.3486  290.4910 12.555804   Positive</span></span></code></pre>
<p>If the user wants to relax the independence between rows and define
an AR1 covariance structure among rows then the model could be fitted
as:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">mixAR1row</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>             random<span class="op">=</span><span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Rowf</span>, Gu<span class="op">=</span><span class="fu"><a href="../reference/AR1mat.html">AR1</a></span><span class="op">(</span><span class="va">Rowf</span>, rho<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">Colf</span>,</span>
<span>             rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>             data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mixAR1row</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                      VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## u:Rowf.Yield-Yield  791.8219  387.8695  2.041465   Positive</span></span>
<span><span class="co">## Colf.Yield-Yield    154.5660  126.8094  1.218885   Positive</span></span>
<span><span class="co">## units.Yield-Yield  3643.6027  290.1689 12.556834   Positive</span></span></code></pre>
<p>The same could be done for the column random effect:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">mixAR1col</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>             random<span class="op">=</span><span class="op">~</span> <span class="va">Rowf</span> <span class="op">+</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Colf</span>, Gu<span class="op">=</span><span class="fu"><a href="../reference/AR1mat.html">AR1</a></span><span class="op">(</span><span class="va">Colf</span>, rho<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>             data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mixAR1col</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                      VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## Rowf.Yield-Yield    830.3623  392.8264  2.113815   Positive</span></span>
<span><span class="co">## u:Colf.Yield-Yield  178.7490  134.2703  1.331262   Positive</span></span>
<span><span class="co">## units.Yield-Yield  3624.6074  287.6072 12.602629   Positive</span></span></code></pre>
<p>If on the other hand, you would like to model the presence of
correlation in row and columns at the same time the model would look
like this:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">mixAR1rowcol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>                  random<span class="op">=</span><span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Rowf</span><span class="op">:</span><span class="va">Colf</span>, </span>
<span>                              Gu<span class="op">=</span><span class="fu">kronecker</span><span class="op">(</span><span class="fu"><a href="../reference/AR1mat.html">AR1</a></span><span class="op">(</span><span class="va">Rowf</span>, rho<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>,<span class="fu"><a href="../reference/AR1mat.html">AR1</a></span><span class="op">(</span><span class="va">Colf</span>, rho<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>,make.dimnames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>                              <span class="op">)</span>,</span>
<span>                  rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>                  data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mixAR1rowcol</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                          VarComp VarCompSE   Zratio Constraint</span></span>
<span><span class="co">## u:Rowf:Colf.Yield-Yield 2474.339  730.1474 3.388821   Positive</span></span>
<span><span class="co">## units.Yield-Yield       2025.584  622.1023 3.256030   Positive</span></span></code></pre>
<p>Notice that if you specify a random effect that is the interaction
between 2 random effects the covariance structure to be specified in the
<code>Gu</code> argument has to be built using the
<code>kronecker()</code> function. The same applies to the
<code><a href="../reference/ARMAmat.html">ARMA()</a></code> and <code><a href="../reference/CSmat.html">CS()</a></code> functions. Please keep in mind
that the correlation values (rho argument) is a fixed value not
estimated by REML like asreml does but you can always follow an
iterative approach.</p>
</div>
<div class="section level3">
<h3 id="can-i-run-gwas-in-met-experiments-with-replicates">6) Can I run GWAS in MET experiments with replicates?<a class="anchor" aria-label="anchor" href="#can-i-run-gwas-in-met-experiments-with-replicates"></a>
</h3>
<p>Yes, please see the vignette for QG using sommer and the method of
GWAS by GBLUP.</p>
</div>
<div class="section level3">
<h3 id="how-can-i-constrain-the-value-of-specific-random-effects">7) How can I constrain the value of specific random effects?<a class="anchor" aria-label="anchor" href="#how-can-i-constrain-the-value-of-specific-random-effects"></a>
</h3>
<p>When using the <code><a href="../reference/vsr.html">vsr()</a></code> function three additional arguments
help to control the following:</p>
<ul>
<li>
<code>Gu</code>: matrix for covariances among levels for the u.th
random effect</li>
<li>
<code>Gti</code>: matrix of initial values for the
variance-covariance components</li>
<li>
<code>Gtc</code>: matrix of constraints for the variance-covariance
components</li>
</ul>
<p>Since each random effect can be seen as a multi-trait variance
covariance structure, the univariate models are just an extension where
the multi-trait variance covariance structure is a 1 x 1 matrix. When
inspecting the results for the mixed models fitted by the
<code><a href="../reference/mmer.html">mmer()</a></code> function corresponding to the variance components
stored in the <code>sigma</code> element, you will notice that each
random effect contains a t x t matrix which corresponds to the
multi-trait structure we referred to. For example:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">GT</span> <span class="op">&lt;-</span> <span class="va">GT_cpdata</span></span>
<span><span class="va">MP</span> <span class="op">&lt;-</span> <span class="va">MP_cpdata</span></span>
<span><span class="co">#### create the variance-covariance matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/A.mat.html">A.mat</a></span><span class="op">(</span><span class="va">GT</span><span class="op">)</span> <span class="co"># additive relationship matrix</span></span>
<span><span class="co">#### look at the data and fit the model</span></span>
<span><span class="va">mix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">id</span>,Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mix1</span><span class="op">$</span><span class="va">sigma</span><span class="op">$</span><span class="va">`u:id`</span></span></code></pre></div>
<pre><code><span><span class="co">##          Yield</span></span>
<span><span class="co">## Yield 650.4145</span></span></code></pre>
<p>Here the sigma element contains the random effects for
<code>id</code> and <code>units</code> (error). Each of these contains a
matrix of 1 by 1, but in a multi trait model would look like this:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_cpdata</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span>
<span><span class="va">GT</span> <span class="op">&lt;-</span> <span class="va">GT_cpdata</span></span>
<span><span class="va">MP</span> <span class="op">&lt;-</span> <span class="va">MP_cpdata</span></span>
<span><span class="co">#### create the variance-covariance matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/A.mat.html">A.mat</a></span><span class="op">(</span><span class="va">GT</span><span class="op">)</span> <span class="co"># additive relationship matrix</span></span>
<span><span class="co">#### look at the data and fit the model</span></span>
<span><span class="va">mix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Yield</span>,<span class="va">color</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">id</span>,Gu<span class="op">=</span><span class="va">A</span>, Gtc<span class="op">=</span><span class="fu"><a href="../reference/unsm.html">unsm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">units</span>,Gtc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mix2</span><span class="op">$</span><span class="va">sigma</span><span class="op">$</span><span class="va">`u:id`</span></span></code></pre></div>
<pre><code><span><span class="co">##             Yield       color</span></span>
<span><span class="co">## Yield 634.6295932 0.471715518</span></span>
<span><span class="co">## color   0.4717155 0.005126228</span></span></code></pre>
<p>Notice that for 2 traits this becomes a 2 by 2 matrix. In order to
put constraints in some of these random effect matrices you can use the
<code>Gtc</code> argument as show above. For the <code>id</code> random
effect we have specified that variance components should be estimated
and be positive (diagonals with a 1), whereas covariance components
should be estimated and unconstrained to be positive or negative
(off-diagonals with a 2).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unsm.html">unsm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2]</span></span>
<span><span class="co">## [1,]    1    2</span></span>
<span><span class="co">## [2,]    2    1</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mix2</span><span class="op">$</span><span class="va">sigma</span><span class="op">$</span><span class="va">`u:id`</span></span></code></pre></div>
<pre><code><span><span class="co">##             Yield       color</span></span>
<span><span class="co">## Yield 634.6295932 0.471715518</span></span>
<span><span class="co">## color   0.4717155 0.005126228</span></span></code></pre>
<p>On the other hand, for the <code>units</code> (error) random effect
we have specified in the <code>Gtc</code> argument that variance
components should be estimated and be positive (diagonals), whereas
covariance components should not be estimated (off-diagonals with a
0)</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2]</span></span>
<span><span class="co">## [1,]    1    0</span></span>
<span><span class="co">## [2,]    0    1</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mix2</span><span class="op">$</span><span class="va">sigma</span><span class="op">$</span><span class="va">`u:units`</span></span></code></pre></div>
<pre><code><span><span class="co">##          Yield       color</span></span>
<span><span class="co">## Yield 4009.336 0.000000000</span></span>
<span><span class="co">## color    0.000 0.002563711</span></span></code></pre>
<p>If the user would like to constrain a value to be fixed and not
change through the estimation process of other random effects the user
needs to provide the initial value (scaled with respect to the error
variance) of those variance-covariance components in the
<code>Gti</code> argument and use a matrix with the value 3 in the
<code>Gtc</code> constraint matrix.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">## matrix to fix the var comp</span></span>
<span><span class="va">initialVal</span> <span class="op">&lt;-</span> <span class="va">mix1</span><span class="op">$</span><span class="va">sigma_scaled</span><span class="op">$</span><span class="va">`u:id`</span><span class="op">/</span><span class="fl">2</span> <span class="co"># we want to fix the vc to be half of the previous uinvariate model</span></span>
<span></span>
<span><span class="va">mix3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">id</span>, Gu<span class="op">=</span><span class="va">A</span>, Gti<span class="op">=</span><span class="va">initialVal</span>, Gtc<span class="op">=</span><span class="va">mm</span><span class="op">)</span>, <span class="co"># constrained</span></span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span>, <span class="co"># unconstrained</span></span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># analyze variance components</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix1</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                     VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## u:id.Yield-Yield   650.4145  325.5562  1.997856   Positive</span></span>
<span><span class="co">## units.Yield-Yield 4031.0153  344.6051 11.697493   Positive</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix3</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                       VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## u:id.Yield-Yield     325.2072  259.0889  1.255196      Fixed</span></span>
<span><span class="co">## u:units.Yield-Yield 4051.3786  352.4804 11.493912   Positive</span></span></code></pre>
<p>For the vsc() function used in mmec() for the c x c problem the theta
and thetaC arguments can be used directly in the covariance structures.
For example to fix the residuals equal to 1:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">## matrix to fix the var comp</span></span>
<span><span class="va">vei</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Yield</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># we want to fix the vc to be half of the previous uinvariate model</span></span>
<span></span>
<span><span class="va">mix3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span><span class="va">Rowf</span>, <span class="co"># unconstrained</span></span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">units</span>, thetaC<span class="op">=</span><span class="va">mm</span>,theta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">vei</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># constrained</span></span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># analyze variance components</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix3</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                VarComp    VarCompSE       Zratio Constraint</span></span>
<span><span class="co">## Rowf:isc:isc  976.0743 8.916127e-16 1.094729e+18   Positive</span></span>
<span><span class="co">## units:mm:vei:   1.0000 1.227629e-03 8.145785e+02      Fixed</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="how-can-i-constrain-two-variance-components-to-be-equal">8) How can I constrain two variance components to be equal?<a class="anchor" aria-label="anchor" href="#how-can-i-constrain-two-variance-components-to-be-equal"></a>
</h3>
<p>Sometimes the built-in capacities of sommer are not flexible enough
to do all what users want. One of those situations is to fix variance
components to be equal. Let’s simulate some multitrait data:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">"MASS"</a></span><span class="op">)</span>  <span class="co">## needed for mvrnorm</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">mu</span>,<span class="va">Sigma</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y1"</span>,<span class="st">"y2"</span><span class="op">)</span></span>
<span><span class="co">## this simulates multivariate normal rvs</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>Now lets assume that we want to fit a multitrait model with an
unstructured error variance structure with the built-in capacity. That
would be as easy as this:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y1</span>,<span class="va">y2</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>, rcov<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">units</span>, Gtc<span class="op">=</span><span class="fu"><a href="../reference/unsm.html">unsm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">df1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mix1</span><span class="op">$</span><span class="va">sigma</span></span></code></pre></div>
<pre><code><span><span class="co">## $`u:units`</span></span>
<span><span class="co">##          y1        y2</span></span>
<span><span class="co">## y1 9.902536  5.543521</span></span>
<span><span class="co">## y2 5.543521 10.125877</span></span></code></pre>
<p>But now assume that you would like to constrain the variance of
<code>y1</code> and <code>y2</code> to be equal. This requires the user
to take a different approach. The user can build externally the
multitrait matrices and fit them directly. Let’s do this to recreate the
exact same result as using the built-in capabilities:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">V1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">V2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">V3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sig1</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span>,<span class="va">V1</span><span class="op">)</span> <span class="co"># variance component 1</span></span>
<span><span class="va">sig2</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span>,<span class="va">V2</span><span class="op">)</span> <span class="co"># variance component 2</span></span>
<span><span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span>,<span class="va">V3</span><span class="op">)</span> <span class="co"># covariance component</span></span>
<span><span class="co"># now fit the model</span></span>
<span><span class="va">mix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">X</span><span class="op">-</span><span class="fl">1</span>, rcov <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">sig1</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">sig2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">gam</span>,Gti <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">.15</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">df2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mix2</span><span class="op">$</span><span class="va">sigmaVector</span></span></code></pre></div>
<pre><code><span><span class="co">## u:sig1.y-y u:sig2.y-y  u:gam.y-y </span></span>
<span><span class="co">##   9.902350  10.125683   5.543179</span></span></code></pre>
<p>Notice that we fitted a univariate model but we built the kernels and
fitted those kernels one by one.</p>
<p>Now we will constrain the two variance components to be equal. This
is done the following way:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig</span> <span class="op">&lt;-</span> <span class="va">sig1</span><span class="op">+</span><span class="va">sig2</span></span>
<span><span class="va">mix3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">X</span><span class="op">-</span><span class="fl">1</span>, rcov <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">gam</span>,Gti <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">.15</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">df2</span>, nIters<span class="op">=</span><span class="fl">30</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mix3</span><span class="op">$</span><span class="va">sigmaVector</span></span></code></pre></div>
<pre><code><span><span class="co">## u:sig.y-y u:gam.y-y </span></span>
<span><span class="co">## 10.014017  5.543179</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="i-get-an-error-when-installing-directly-from-github">9) I get an error when installing directly from github<a class="anchor" aria-label="anchor" href="#i-get-an-error-when-installing-directly-from-github"></a>
</h3>
<p>Some people experience issues when trying to install the newest
version of sommer from GitHub in their mac computer using the following
command line:</p>
<p>devtools::install_github(‘covaruber/sommer’)</p>
<p>one of the error messages that have been identified by users is
related to the installation of the gfortran compiler. If you have that
issue, the information of the following website may solve your
instalation problem:</p>
<p><a href="https://www.cynkra.com/blog/2021-03-16-gfortran-macos/" class="external-link uri">https://www.cynkra.com/blog/2021-03-16-gfortran-macos/</a></p>
</div>
<div class="section level3">
<h3 id="i-get-an-error-when-specifying-an-interaction-of-the-form-xz">10) I get an error when specifying an interaction of the form
X:Z<a class="anchor" aria-label="anchor" href="#i-get-an-error-when-specifying-an-interaction-of-the-form-xz"></a>
</h3>
<p>If you get an error message similar to the following when specifying
an interaction in your model:</p>
<p>Error in X:Z : NA/NaN argument In addition: Warning messages: 1: In
X:Z : numerical expression has “n” elements: only the first used 2: In
X:Z : numerical expression has “n” elements: only the first used 3: In
eval(substitute(expr), data, enclos = parent.frame()) : NAs introduced
by coercion</p>
<p>Please check that your variables in the interaction are all of class
factor. Making all factors using the as.factor() function should fix
your error.</p>
</div>
<div class="section level3">
<h3 id="i-get-the-error-contrasts-tmp-value-contr-funs1-isofnn">11) I get the error: contrasts&lt;-(<code>*tmp*</code>, value =
contr.funs[1 + isOF[nn]])<a class="anchor" aria-label="anchor" href="#i-get-the-error-contrasts-tmp-value-contr-funs1-isofnn"></a>
</h3>
<p>If you get an error message similar to the following when fitting
your model:</p>
<p>Error in contrasts&lt;-(<code>*tmp*</code>, value = contr.funs[1 +
isOF[nn]]) : contrasts can be applied only to factors with 2 or more
levels</p>
<p>Please check that your dataset is a regular dataframe. If your
dataset used as input is of class tibtable or any other you may get this
error message. Please use the following command to fix the issue:</p>
<p>dataset &lt;- as.data.frame(dataset)</p>
<p>This should put the dataset in the expected format.</p>
</div>
<div class="section level3">
<h3 id="i-get-an-error-error-addition-incompatible-matrix-dimensions-n1xn1-and-n2xn2">12) I get an error “Error: addition: incompatible matrix dimensions:
n1xn1 and n2xn2”<a class="anchor" aria-label="anchor" href="#i-get-an-error-error-addition-incompatible-matrix-dimensions-n1xn1-and-n2xn2"></a>
</h3>
<p>This is very likely because you’re fitting a different residual
variance for different levels of a random variable. Please make sure you
sort your dataset by the variables you’re fitting the residuals at. For
example:</p>
<p>DT=DT[with(DT, order(Env)), ]</p>
<p>sorts a data set named DT by levels of a variable named Env. That way
a model with a different residual variance for each level of Env can be
fitted as:</p>
<p>rcov ~ vsc(dsc(Env), isc(units))</p>
</div>
<div class="section level3">
<h3 id="my-mmec-model-only-runs-few-iterations-giving-meaningless-results">13) My mmec model only runs few iterations giving meaningless
results<a class="anchor" aria-label="anchor" href="#my-mmec-model-only-runs-few-iterations-giving-meaningless-results"></a>
</h3>
<p>This can happen when the units of your trait being modeled are either
too small or too big. Try scaling the units of your trait so the
differences between the levels is not in either too big (var&gt;10,000)
or too small units (var &lt; 0.01). Alternatively, modify the argument
tolParInv to a smaller value like 1e-8 or higher. Last and probably the
best since is guaranteed to work is, scale your trait using the scale()
function.</p>
</div>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>Covarrubias-Pazaran G. 2016. Genome assisted prediction of
quantitative traits using the R package sommer. PLoS ONE 11(6):1-15.</p>
<p>Covarrubias-Pazaran G. 2018. Software update: Moving the R package
sommer to multivariate mixed models for genome-assisted prediction. doi:
<a href="https://doi.org/10.1101/354639" class="external-link uri">https://doi.org/10.1101/354639</a></p>
<p>Bernardo Rex. 2010. Breeding for quantitative traits in plants.
Second edition. Stemma Press. 390 pp.</p>
<p>Gilmour et al. 1995. Average Information REML: An efficient algorithm
for variance parameter estimation in linear mixed models. Biometrics
51(4):1440-1450.</p>
<p>Henderson C.R. 1975. Best Linear Unbiased Estimation and Prediction
under a Selection Model. Biometrics vol. 31(2):423-447.</p>
<p>Kang et al. 2008. Efficient control of population structure in model
organism association mapping. Genetics 178:1709-1723.</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models and nested
bases. Computational Statistics and Data Analysis, 61, 22 - 37.</p>
<p>Lee et al. 2015. MTG2: An efficient algorithm for multivariate linear
mixed model analysis based on genomic information. Cold Spring Harbor.
doi: <a href="http://dx.doi.org/10.1101/027201" class="external-link uri">http://dx.doi.org/10.1101/027201</a>.</p>
<p>Maier et al. 2015. Joint analysis of psychiatric disorders increases
accuracy of risk prediction for schizophrenia, bipolar disorder, and
major depressive disorder. Am J Hum Genet; 96(2):283-294.</p>
<p>Rodriguez-Alvarez, Maria Xose, et al. Correcting for spatial
heterogeneity in plant breeding experiments with P-splines. Spatial
Statistics 23 (2018): 52-71.</p>
<p>Searle. 1993. Applying the EM algorithm to calculating ML and REML
estimates of variance components. Paper invited for the 1993 American
Statistical Association Meeting, San Francisco.</p>
<p>Yu et al. 2006. A unified mixed-model method for association mapping
that accounts for multiple levels of relatedness. Genetics
38:203-208.</p>
<p>Tunnicliffe W. 1989. On the use of marginal likelihood in time series
model estimation. JRSS 51(1):15-27.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
