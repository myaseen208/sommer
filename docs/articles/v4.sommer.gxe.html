<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting genotype by environment models in sommer • sommer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting genotype by environment models in sommer">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting genotype by environment models in sommer</h1>
                        <h4 data-toc-skip class="author">Giovanny
Covarrubias-Pazaran</h4>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/covaruber/sommer/blob/HEAD/vignettes/v4.sommer.gxe.Rmd"><code>vignettes/v4.sommer.gxe.Rmd</code></a></small>
      <div class="d-none name"><code>v4.sommer.gxe.Rmd</code></div>
    </div>

    
    
<p>The sommer package was developed to provide R users a powerful and
reliable multivariate mixed model solver. The package is focused on two
approaches: 1) p &gt; n (more effects to estimate than observations)
using the mmer() function, and 2) n &gt; p (more observations than
effects to estimate) using the mmec() function. The core algorithms are
coded in C++ using the Armadillo library. This package allows the user
to fit mixed models with the advantage of specifying the
variance-covariance structure for the random effects, specifying
heterogeneous variances, and obtaining other parameters such as BLUPs,
BLUEs, residuals, fitted values, variances for fixed and random effects,
etc.</p>
<p>The purpose of this vignette is to show how to fit different genotype
by environment (GxE) models using the sommer package:</p>
<ol style="list-style-type: decimal">
<li>Single environment model</li>
<li>Multienvironment model: Main effect model</li>
<li>Multienvironment model: Diagonal model (DG)</li>
<li>Multienvironment model: Compund symmetry model (CS)</li>
<li>Multienvironment model: Unstructured model (US)</li>
<li>Multienvironment model: Random regression model (RR)</li>
<li>Multienvironment model: Other covariance structures for GxE</li>
<li>Multienvironment model: Finlay-Wilkinson regression</li>
<li>Multienvironment model: Factor analytic (reduced rank) model
(FA)</li>
<li>Two stage analysis</li>
</ol>
<p>When the breeder decides to run a trial and apply selection in a
single environment (whether because the amount of seed is a limitation
or there’s no availability for a location) the breeder takes the risk of
selecting material for a target population of environments (TPEs) using
an environment that is not representative of the larger TPE. Therefore,
many breeding programs try to base their selection decision on
multi-environment trial (MET) data. Models could be adjusted by adding
additional information like spatial information, experimental design
information, etc. In this tutorial we will focus mainly on the
covariance structures for GxE and the incorporation of relationship
matrices for the genotype effect.</p>
<div class="section level2">
<h2 id="single-environment-model">1) Single environment model<a class="anchor" aria-label="anchor" href="#single-environment-model"></a>
</h2>
<p>A single-environment model is the one that is fitted when the
breeding program can only afford one location, leaving out the possible
information available from other environments. This will be used to
further expand to GxE models.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: MASS</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: crayon</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_example</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_example</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A_example</span></span>
<span></span>
<span><span class="va">ansSingle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Name</span>, Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansSingle</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -78.80875 159.6175 162.8378     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                    VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## u:Name.Yield-Yield   6.529     2.202  2.965   Positive</span></span>
<span><span class="co">## units.Yield-Yield   13.868     1.633  8.494   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)    11.74    0.4876   24.07</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##        Yield</span></span>
<span><span class="co">## u:Name    41</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or</span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">ansSingle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">Ai</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansSingle</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -359.0031 720.0062 723.2266     AI     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                 VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## Name:Ai:isc:isc   6.495     1.479  4.392   Positive</span></span>
<span><span class="co">## units:isc:isc    13.869     1.799  7.711   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##             Estimate Std.Error t.value</span></span>
<span><span class="co">## (Intercept)    11.74    0.4861   24.15</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<p>In this model, the only term to be estimated is the one for the
germplasm (here called <code>Name</code>). For the sake of example we
have added a relationship matrix among the levels of the random effect
<code>Name</code>. This is just a diagonal matrix with as many rows and
columns as levels present in the random effect <code>Name</code>, but
any other non-diagonal relationship matrix could be used.</p>
</div>
<div class="section level2">
<h2 id="met-main-effect-model">2) MET: main effect model<a class="anchor" aria-label="anchor" href="#met-main-effect-model"></a>
</h2>
<p>A multi-environment model is the one that is fitted when the breeding
program can afford more than one location. The main effect model assumes
that GxE doesn’t exist and that the main genotype effect plus the fixed
effect for environment is enough to predict the genotype effect in all
locations of interest.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ansMain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Name</span>, Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansMain</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -32.59421 71.18842 80.84949     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                    VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## u:Name.Yield-Yield   4.856    1.5233  3.188   Positive</span></span>
<span><span class="co">## units.Yield-Yield    8.109    0.9615  8.434   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.385    0.5849  28.012</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.688    0.5741  -9.908</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.218    0.6107 -10.182</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##        Yield</span></span>
<span><span class="co">## u:Name    41</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or </span></span>
<span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">ansMain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">Ai</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansMain</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -313.3005 632.6011 642.2621     AI     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                 VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## Name:Ai:isc:isc   4.854     1.449  3.350   Positive</span></span>
<span><span class="co">## units:isc:isc     8.109     1.807  4.486   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##           Estimate Std.Error t.value</span></span>
<span><span class="co">## Intercept   16.385    0.5847  28.021</span></span>
<span><span class="co">## CA.2012     -5.688    0.5741  -9.909</span></span>
<span><span class="co">## CA.2013     -6.219    0.6107 -10.183</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="met-diagonal-model-dg">3) MET: diagonal model (DG)<a class="anchor" aria-label="anchor" href="#met-diagonal-model-dg"></a>
</h2>
<p>A multi-environment model is the one that is fitted when the breeding
program can afford more than one location. The diagonal model assumes
that GxE exists and that the genotype variation is expressed differently
at each location, therefore fitting a variance component for the
genotype effect at each location. The main drawback is that this model
assumes no covariance among locations, as if genotypes were independent
(despite the fact that is the same genotypes). The fixed effect for
environment plus the location-specific BLUP is used to predict the
genotype effect in each locations of interest.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ansDG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsr.html">dsr</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span>,<span class="va">Name</span>, Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansDG</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -21.04157 48.08315 57.74421     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                          VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## CA.2011:Name.Yield-Yield  17.493    6.1099  2.863   Positive</span></span>
<span><span class="co">## CA.2012:Name.Yield-Yield   5.337    1.7662  3.022   Positive</span></span>
<span><span class="co">## CA.2013:Name.Yield-Yield   7.884    2.5526  3.089   Positive</span></span>
<span><span class="co">## units.Yield-Yield          4.381    0.6493  6.747   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.621     0.948  17.532</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.958     1.045  -5.699</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.662     1.098  -6.067</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##              Yield</span></span>
<span><span class="co">## CA.2011:Name    41</span></span>
<span><span class="co">## CA.2012:Name    41</span></span>
<span><span class="co">## CA.2013:Name    41</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or</span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">ansDG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsc.html">dsc</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span>,<span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">Ai</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansDG</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## =============================================================</span></span>
<span><span class="co">##           Multivariate Linear Mixed Model fit by REML          </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -301.7528 609.5057 619.1668     AI     TRUE</span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                             VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## Env:Name:Ai:CA.2011:CA.2011  17.124     3.479  4.922   Positive</span></span>
<span><span class="co">## Env:Name:Ai:CA.2012:CA.2012   5.351     2.814  1.901   Positive</span></span>
<span><span class="co">## Env:Name:Ai:CA.2013:CA.2013   7.904     2.924  2.703   Positive</span></span>
<span><span class="co">## units:isc:isc                 4.332     2.258  1.919   Positive</span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##           Estimate Std.Error t.value</span></span>
<span><span class="co">## Intercept   16.621    0.9386  17.709</span></span>
<span><span class="co">## CA.2012     -5.958    1.0367  -5.747</span></span>
<span><span class="co">## CA.2013     -6.662    1.0898  -6.113</span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="met-compund-symmetry-model-cs">4) MET: compund symmetry model (CS)<a class="anchor" aria-label="anchor" href="#met-compund-symmetry-model-cs"></a>
</h2>
<p>A multi-environment model is the one that is fitted when the breeding
program can afford more than one location. The compound symmetry model
assumes that GxE exists and that a main genotype variance-covariance
component is expressed across all location. In addition, it assumes that
a main genotype-by-environment variance is expressed across all
locations. The main drawback is that the model assumes the same variance
and covariance among locations. The fixed effect for environment plus
the main effect for BLUP plus genotype-by-environment effect is used to
predict the genotype effect in each location of interest.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span></span>
<span><span class="va">EA</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="va">E</span>,<span class="va">A</span>, make.dimnames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ansCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Name</span>, Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Env</span><span class="op">:</span><span class="va">Name</span>, Gu<span class="op">=</span><span class="va">EA</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansCS</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -20.14538 46.29075 55.95182     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                        VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## u:Name.Yield-Yield       3.682     1.691  2.177   Positive</span></span>
<span><span class="co">## u:Env:Name.Yield-Yield   5.173     1.495  3.460   Positive</span></span>
<span><span class="co">## units.Yield-Yield        4.366     0.647  6.748   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.496    0.6855  24.065</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.777    0.7558  -7.643</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.380    0.7960  -8.015</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##            Yield</span></span>
<span><span class="co">## u:Name        41</span></span>
<span><span class="co">## u:Env:Name   123</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## or</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span></span>
<span><span class="va">Ei</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span>
<span><span class="va">EAi</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="va">Ei</span>,<span class="va">Ai</span>, make.dimnames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Ei</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">Ei</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">Ai</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">EAi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">EAi</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">ansCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">Ai</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Env</span><span class="op">:</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">EAi</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>, </span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansCS</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -300.8517 607.7034 617.3645     AI     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                      VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## Name:Ai:isc:isc        3.683     1.881  1.958   Positive</span></span>
<span><span class="co">## Env:Name:EAi:isc:isc   5.174     2.420  2.138   Positive</span></span>
<span><span class="co">## units:isc:isc          4.360     2.270  1.920   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##           Estimate Std.Error t.value</span></span>
<span><span class="co">## Intercept   16.496    0.6856  24.062</span></span>
<span><span class="co">## CA.2012     -5.777    0.7558  -7.643</span></span>
<span><span class="co">## CA.2013     -6.380    0.7960  -8.015</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="met-unstructured-model-us">5) MET: unstructured model (US)<a class="anchor" aria-label="anchor" href="#met-unstructured-model-us"></a>
</h2>
<p>A multi-environment model is the one that is fitted when the breeding
program can afford more than one location. The unstructured model is the
most flexible model assuming that GxE exists and that an
environment-specific variance exists in addition to as many covariances
for each environment-to-environment combinations. The main drawback is
that is difficult to make this models converge because of the large
number of variance components, the fact that some of these variance or
covariance components are zero, and the difficulty in choosing good
starting values. The fixed effect for environment plus the environment
specific BLUP (adjusted by covariances) is used to predict the genotype
effect in each location of interest.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ansUS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/usr.html">usr</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span>,<span class="va">Name</span>, Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansUS</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ==================================================================</span></span>
<span><span class="co">##             Multivariate Linear Mixed Model fit by REML            </span></span>
<span><span class="co">## *************************  sommer 4.3  ************************* </span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -14.20951 34.41901 44.08008     NR     TRUE</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                                  VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## CA.2011:Name.Yield-Yield          15.994     5.381  2.972   Positive</span></span>
<span><span class="co">## CA.2012:CA.2011:Name.Yield-Yield   6.172     2.503  2.465   Unconstr</span></span>
<span><span class="co">## CA.2012:Name.Yield-Yield           5.273     1.750  3.013   Positive</span></span>
<span><span class="co">## CA.2013:CA.2011:Name.Yield-Yield   6.366     3.069  2.074   Unconstr</span></span>
<span><span class="co">## CA.2013:CA.2012:Name.Yield-Yield   0.376     1.535  0.245   Unconstr</span></span>
<span><span class="co">## CA.2013:Name.Yield-Yield           7.689     2.490  3.088   Positive</span></span>
<span><span class="co">## units.Yield-Yield                  4.386     0.650  6.748   Positive</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.341    0.8141  20.072</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.696    0.7406  -7.692</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.286    0.8202  -7.664</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##                      Yield</span></span>
<span><span class="co">## CA.2011:Name            41</span></span>
<span><span class="co">## CA.2012:CA.2011:Name    82</span></span>
<span><span class="co">## CA.2012:Name            41</span></span>
<span><span class="co">## CA.2013:CA.2011:Name    82</span></span>
<span><span class="co">## CA.2013:CA.2012:Name    82</span></span>
<span><span class="co">## CA.2013:Name            41</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adjust variance BLUPs by adding covariances</span></span>
<span><span class="co"># ansUS$U[1:6] &lt;- unsBLUP(ansUS$U[1:6])</span></span>
<span></span>
<span><span class="co"># or</span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span>
<span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">Ai</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="va">ansUS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/usc.html">usc</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span>,<span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">Ai</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansUS</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## =============================================================</span></span>
<span><span class="co">##           Multivariate Linear Mixed Model fit by REML          </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">##          logLik      AIC     BIC Method Converge</span></span>
<span><span class="co">## Value -295.2125 596.4249 606.086     AI     TRUE</span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                             VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## Env:Name:Ai:CA.2011:CA.2011 14.8143     3.513 4.2167   Positive</span></span>
<span><span class="co">## Env:Name:Ai:CA.2011:CA.2012  5.7221     1.957 2.9241   Unconstr</span></span>
<span><span class="co">## Env:Name:Ai:CA.2012:CA.2012  4.9599     2.263 2.1913   Positive</span></span>
<span><span class="co">## Env:Name:Ai:CA.2011:CA.2013  6.1289     2.726 2.2481   Unconstr</span></span>
<span><span class="co">## Env:Name:Ai:CA.2012:CA.2013  0.6439     1.899 0.3391   Unconstr</span></span>
<span><span class="co">## Env:Name:Ai:CA.2013:CA.2013  7.5772     2.905 2.6084   Positive</span></span>
<span><span class="co">## units:isc:isc                4.0134     2.171 1.8483   Positive</span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##           Estimate Std.Error t.value</span></span>
<span><span class="co">## Intercept   16.344    0.7847  20.828</span></span>
<span><span class="co">## CA.2012     -5.693    0.7150  -7.963</span></span>
<span><span class="co">## CA.2013     -6.277    0.7918  -7.927</span></span>
<span><span class="co">## =============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="met-random-regression-model">6) MET: random regression model<a class="anchor" aria-label="anchor" href="#met-random-regression-model"></a>
</h2>
<p>A multi-environment model is the one that is fitted when the breeding
program can afford more than one location. The random regression model
assumes that the environment can be seen as a continuous variable and
therefore a variance component for the intercept and a variance
component for the slope can be fitted. The number of variance components
will depend on the order of the Legendre polynomial fitted.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">orthopolynom</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">$</span><span class="va">EnvN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ansRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/leg.html">leg</a></span><span class="op">(</span><span class="va">EnvN</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">Name</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansRR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -27.70318 61.40636 71.06743     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                       VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## leg0:Name.Yield-Yield  10.392    3.1473  3.302   Positive</span></span>
<span><span class="co">## leg1:Name.Yield-Yield   2.079    0.9792  2.123   Positive</span></span>
<span><span class="co">## units.Yield-Yield       6.297    0.8442  7.459   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.541    0.6770  24.432</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.832    0.6425  -9.078</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.472    0.8239  -7.854</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##           Yield</span></span>
<span><span class="co">## leg0:Name    41</span></span>
<span><span class="co">## leg1:Name    41</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or</span></span>
<span></span>
<span><span class="va">ansRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsc.html">dsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/leg.html">leg</a></span><span class="op">(</span><span class="va">EnvN</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansRR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -308.4098 622.8195 632.4806     AI     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                     VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## EnvN:Name:leg0:leg0  10.355     2.319  4.465   Positive</span></span>
<span><span class="co">## EnvN:Name:leg1:leg1   2.079     1.759  1.182   Positive</span></span>
<span><span class="co">## units:isc:isc         6.304     2.005  3.145   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##           Estimate Std.Error t.value</span></span>
<span><span class="co">## Intercept   16.541    0.6761  24.467</span></span>
<span><span class="co">## CA.2012     -5.833    0.6421  -9.084</span></span>
<span><span class="co">## CA.2013     -6.472    0.8233  -7.861</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<p>In addition, an unstructured, diagonal or other variance-covariance
structure can be put on top of the polynomial model:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">orthopolynom</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">$</span><span class="va">EnvN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ansRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/usr.html">usr</a></span><span class="op">(</span><span class="fu"><a href="../reference/leg.html">leg</a></span><span class="op">(</span><span class="va">EnvN</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="va">Name</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansRR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -25.56967 57.13935 66.80042     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                            VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## leg0:Name.Yield-Yield       10.791    3.2745  3.295   Positive</span></span>
<span><span class="co">## leg1:leg0:Name.Yield-Yield  -2.428    1.3699 -1.772   Unconstr</span></span>
<span><span class="co">## leg1:Name.Yield-Yield        2.286    1.0404  2.197   Positive</span></span>
<span><span class="co">## units.Yield-Yield            6.260    0.8421  7.434   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.501    0.7778  21.216</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.791    0.6704  -8.638</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.476    0.8554  -7.570</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##                Yield</span></span>
<span><span class="co">## leg0:Name         41</span></span>
<span><span class="co">## leg1:leg0:Name    82</span></span>
<span><span class="co">## leg1:Name         41</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or</span></span>
<span></span>
<span><span class="va">ansRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/usc.html">usc</a></span><span class="op">(</span><span class="fu"><a href="../reference/leg.html">leg</a></span><span class="op">(</span><span class="va">EnvN</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansRR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC      BIC Method Converge</span></span>
<span><span class="co">## Value -308.7042 623.4085 633.0695     AI     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                     VarComp VarCompSE  Zratio Constraint</span></span>
<span><span class="co">## EnvN:Name:leg0:leg0 10.6512     2.242 4.75048   Positive</span></span>
<span><span class="co">## EnvN:Name:leg0:leg1  0.1204     1.445 0.08328   Unconstr</span></span>
<span><span class="co">## EnvN:Name:leg1:leg1  2.0947     1.920 1.09114   Positive</span></span>
<span><span class="co">## units:isc:isc        6.6403     2.042 3.25168   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##           Estimate Std.Error t.value</span></span>
<span><span class="co">## Intercept   16.541    0.6826  24.234</span></span>
<span><span class="co">## CA.2012     -5.833    0.6533  -8.929</span></span>
<span><span class="co">## CA.2013     -6.469    0.8349  -7.748</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="other-gxe-covariance-structures">7) Other GxE covariance structures<a class="anchor" aria-label="anchor" href="#other-gxe-covariance-structures"></a>
</h2>
<p>Although not very commonly used in GxE models, the autoregressive of
order 1 (AR1) and other covariance structures could be used in the GxE
modeling. Here we show how to do it (not recommending it).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AR1mat.html">AR1</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span> <span class="co"># can be AR1() or CS(), etc.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span></span>
<span><span class="va">EA</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="va">E</span>,<span class="va">A</span>, make.dimnames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ansCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Name</span>, Gu<span class="op">=</span><span class="va">A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="va">Env</span><span class="op">:</span><span class="va">Name</span>, Gu<span class="op">=</span><span class="va">EA</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span> <span class="op">~</span> <span class="va">units</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ansCS</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ============================================================</span></span>
<span><span class="co">##          Multivariate Linear Mixed Model fit by REML         </span></span>
<span><span class="co">## **********************  sommer 4.3  ********************** </span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">##          logLik      AIC     BIC Method Converge</span></span>
<span><span class="co">## Value -19.39067 44.78134 54.4424     NR     TRUE</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Variance-Covariance components:</span></span>
<span><span class="co">##                        VarComp VarCompSE Zratio Constraint</span></span>
<span><span class="co">## u:Name.Yield-Yield       2.225    1.7536  1.269   Positive</span></span>
<span><span class="co">## u:Env:Name.Yield-Yield   6.424    1.8293  3.512   Positive</span></span>
<span><span class="co">## units.Yield-Yield        4.334    0.6418  6.752   Positive</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##   Trait      Effect Estimate Std.Error t.value</span></span>
<span><span class="co">## 1 Yield (Intercept)   16.484    0.6735  24.474</span></span>
<span><span class="co">## 2 Yield  EnvCA.2012   -5.780    0.7365  -7.848</span></span>
<span><span class="co">## 3 Yield  EnvCA.2013   -6.372    0.7799  -8.170</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Groups and observations:</span></span>
<span><span class="co">##            Yield</span></span>
<span><span class="co">## u:Name        41</span></span>
<span><span class="co">## u:Env:Name   123</span></span>
<span><span class="co">## ============================================================</span></span>
<span><span class="co">## Use the '$' sign to access results and parameters</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="finlay-wilkinson-regression">8) Finlay-Wilkinson regression<a class="anchor" aria-label="anchor" href="#finlay-wilkinson-regression"></a>
</h2>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_h2</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_h2</span></span>
<span></span>
<span><span class="co">## build the environmental index</span></span>
<span><span class="va">ei</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">Env</span>, data<span class="op">=</span><span class="va">DT</span>,FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ei</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"envIndex"</span></span>
<span><span class="va">ei</span><span class="op">$</span><span class="va">envIndex</span> <span class="op">&lt;-</span> <span class="va">ei</span><span class="op">$</span><span class="va">envIndex</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ei</span><span class="op">$</span><span class="va">envIndex</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># center the envIndex to have clean VCs</span></span>
<span><span class="va">ei</span> <span class="op">&lt;-</span> <span class="va">ei</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">ei</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">envIndex</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">## add the environmental index to the original dataset</span></span>
<span><span class="va">DT2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>,<span class="va">ei</span>, by<span class="op">=</span><span class="st">"Env"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># numeric by factor variables like envIndex:Name can't be used in the random part like this</span></span>
<span><span class="co"># they need to come with the vsc() structure</span></span>
<span><span class="va">DT2</span> <span class="op">&lt;-</span> <span class="va">DT2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">DT2</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">mix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span> <span class="va">envIndex</span>,</span>
<span>             random<span class="op">=</span><span class="op">~</span> <span class="va">Name</span> <span class="op">+</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsc.html">dsc</a></span><span class="op">(</span><span class="va">envIndex</span><span class="op">)</span>,<span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">DT2</span>,</span>
<span>             rcov<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsc.html">dsc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>,<span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             tolParConvNorm <span class="op">=</span> <span class="fl">.0001</span>,</span>
<span>             nIters <span class="op">=</span> <span class="fl">50</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'as(&lt;dgeMatrix&gt;, "dgCMatrix")' is deprecated.</span></span>
<span><span class="co">## Use 'as(., "CsparseMatrix")' instead.</span></span>
<span><span class="co">## See help("Deprecated") and help("Matrix-deprecated").</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summary(mix2)$varcomp</span></span>
<span></span>
<span><span class="va">b</span><span class="op">=</span><span class="va">mix2</span><span class="op">$</span><span class="va">uList</span><span class="op">$</span><span class="va">`vsc(dsc(envIndex), isc(Name))`</span> <span class="co"># adaptability (b) or genotype slopes</span></span>
<span><span class="va">mu</span><span class="op">=</span><span class="va">mix2</span><span class="op">$</span><span class="va">uList</span><span class="op">$</span><span class="va">`vsc( isc( Name ) )`</span> <span class="co"># general adaptation (mu) or main effect</span></span>
<span><span class="va">e</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix2</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># error variance for each individual</span></span>
<span></span>
<span><span class="co">## general adaptation (main effect) vs adaptability (response to better environments)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="va">b</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, ylab<span class="op">=</span><span class="st">"general adaptation"</span>, xlab<span class="op">=</span><span class="st">"adaptability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">mu</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,x<span class="op">=</span><span class="va">b</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">0.5</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="v4.sommer.gxe_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## prediction across environments</span></span>
<span><span class="va">Dt</span> <span class="op">&lt;-</span> <span class="va">mix2</span><span class="op">$</span><span class="va">Dtable</span></span>
<span><span class="va">Dt</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"average"</span><span class="op">]</span><span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="va">Dt</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"include"</span><span class="op">]</span><span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="va">Dt</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"include"</span><span class="op">]</span><span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mix2</span>,Dtable <span class="op">=</span> <span class="va">Dt</span>, D<span class="op">=</span><span class="st">"Name"</span><span class="op">)</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">pp</span><span class="op">$</span><span class="va">pvals</span></span>
<span><span class="co"># preds[with(preds, order(-predicted.value)), ]</span></span>
<span><span class="co">## performance vs stability (deviation from regression line)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">preds</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">~</span><span class="va">e</span>, ylab<span class="op">=</span><span class="st">"performance"</span>, xlab<span class="op">=</span><span class="st">"stability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">preds</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,x<span class="op">=</span><span class="va">e</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">0.5</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="v4.sommer.gxe_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="factor-analytic-reduced-rank-model">9) Factor analytic (reduced rank) model<a class="anchor" aria-label="anchor" href="#factor-analytic-reduced-rank-model"></a>
</h2>
<p>When the number of environments where genotypes are evaluated is big
and we want to consider the genetic covariance between environments and
location-specific variance components we cannot fit an unstructured
covariance in the model since the number of parameters is too big and
the matrix can become non-full rank leading to singularities. In those
cases is suggested a dimensionality reduction technique. Among those the
factor analytic structures proposed by many research groups (Piepho,
Smith, Cullis, Thompson, Meyer, etc.) are the way to go. Sommer has a
reduced-rank factor analytic implementation available through the rrc()
function. Here we show an example of how to fit the model:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_h2</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_h2</span></span>
<span><span class="va">DT</span><span class="op">=</span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          Name     Env Loc Year     Block  y</span></span>
<span><span class="co">## 67   MSL007-B CA.2011  CA 2011 CA.2011.2  5</span></span>
<span><span class="co">## 105  MSL007-B CA.2011  CA 2011 CA.2011.1  6</span></span>
<span><span class="co">## 308  MSK061-4 CA.2011  CA 2011 CA.2011.2  9</span></span>
<span><span class="co">## 393  MSK061-4 CA.2011  CA 2011 CA.2011.1 10</span></span>
<span><span class="co">## 469 MSR169-8Y CA.2011  CA 2011 CA.2011.1 11</span></span>
<span><span class="co">## 471     NY148 CA.2011  CA 2011 CA.2011.1 11</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">indNames</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">indNames</span></span>
<span></span>
<span><span class="co"># fit diagonal model first to produce H matrix</span></span>
<span><span class="va">ansDG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span> <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsc.html">dsc</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span>, <span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>, nIters <span class="op">=</span> <span class="fl">100</span>,</span>
<span>              <span class="co"># we recommend giving more EM iterations at the beggining</span></span>
<span>              emWeight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="../reference/logspace.html">logspace</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.05</span>,<span class="fl">80</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">H0</span> <span class="op">&lt;-</span> <span class="va">ansDG</span><span class="op">$</span><span class="va">uList</span><span class="op">$</span><span class="va">`vsc(dsc(Env), isc(Name))`</span> <span class="co"># GxE table</span></span>
<span></span>
<span><span class="co"># reduced rank model</span></span>
<span><span class="va">ansFA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>              random<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span> <span class="fu"><a href="../reference/usc.html">usc</a></span><span class="op">(</span><span class="fu"><a href="../reference/rrc.html">rrc</a></span><span class="op">(</span><span class="va">Env</span>, H <span class="op">=</span> <span class="va">H0</span>, nPC <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> , <span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># rr</span></span>
<span>                <span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsc.html">dsc</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span>, <span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>, <span class="co"># diag</span></span>
<span>              rcov<span class="op">=</span><span class="op">~</span><span class="va">units</span>,</span>
<span>              <span class="co"># we recommend giving more iterations to these models</span></span>
<span>              nIters <span class="op">=</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              <span class="co"># we recommend giving more EM iterations at the beggining</span></span>
<span>              emWeight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="../reference/logspace.html">logspace</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.05</span>,<span class="fl">80</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              data<span class="op">=</span><span class="va">DT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vcFA</span> <span class="op">&lt;-</span> <span class="va">ansFA</span><span class="op">$</span><span class="va">theta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">vcDG</span> <span class="op">&lt;-</span> <span class="va">ansFA</span><span class="op">$</span><span class="va">theta</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">loadings</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fu"><a href="../reference/rrc.html">rrc</a></span><span class="op">(</span><span class="va">Env</span>, nPC <span class="op">=</span> <span class="fl">3</span>, H <span class="op">=</span> <span class="va">H0</span>, returnGamma <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span><span class="op">$</span><span class="va">Gamma</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="va">ansFA</span><span class="op">$</span><span class="va">uList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vcUS</span> <span class="op">&lt;-</span> <span class="va">loadings</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">vcFA</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">loadings</span><span class="op">)</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="va">vcUS</span> <span class="op">+</span> <span class="va">vcDG</span></span>
<span><span class="co"># colfunc &lt;- colorRampPalette(c("steelblue4","springgreen","yellow"))</span></span>
<span><span class="co"># hv &lt;- heatmap(cov2cor(G), col = colfunc(100), symm = TRUE)</span></span>
<span></span>
<span><span class="va">uFA</span> <span class="op">&lt;-</span> <span class="va">scores</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">loadings</span><span class="op">)</span></span>
<span><span class="va">uDG</span> <span class="op">&lt;-</span> <span class="va">ansFA</span><span class="op">$</span><span class="va">uList</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">uFA</span> <span class="op">+</span> <span class="va">uDG</span></span></code></pre></div>
<p>As can be seen genotype BLUPs for all environments can be recovered
by multiplying the loadings (Gamma) by the factor scores. This is a
parsomonious way to model an unstructured covariance.</p>
</div>
<div class="section level2">
<h2 id="two-stage-analysis">10) Two stage analysis<a class="anchor" aria-label="anchor" href="#two-stage-analysis"></a>
</h2>
<p>It is common then to fit a first model that accounts for the
variation of random design elements, e.g., locations, years, blocks, and
fixed genotype effects to obtain the estimated marginal means (EMMs) or
best linear unbiased estimators (BLUEs) as adjusted entry means. These
adjusted entry means are then used as the phenotype or response variable
in GWAS and genomic prediction studies.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##########</span></span>
<span><span class="co">## stage 1</span></span>
<span><span class="co">## use mmer for dense field trials</span></span>
<span><span class="co">##########</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_h2</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_h2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 Name     Env Loc Year     Block y</span></span>
<span><span class="co">## 1            W8822-3 FL.2012  FL 2012 FL.2012.1 2</span></span>
<span><span class="co">## 2            W8867-7 FL.2012  FL 2012 FL.2012.2 2</span></span>
<span><span class="co">## 3           MSL007-B MO.2011  MO 2011 MO.2011.1 3</span></span>
<span><span class="co">## 4         CO00270-7W FL.2012  FL 2012 FL.2012.2 3</span></span>
<span><span class="co">## 5 Manistee(MSL292-A) FL.2013  FL 2013 FL.2013.2 3</span></span>
<span><span class="co">## 6           MSM246-B FL.2012  FL 2012 FL.2012.2 3</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span></span>
<span><span class="va">BLUEL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">XtXL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ans1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">Name</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>                random<span class="op">=</span><span class="op">~</span><span class="va">Block</span>,</span>
<span>                verbose<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Env</span> <span class="op">==</span> <span class="va">envs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>               <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">ans1</span><span class="op">$</span><span class="va">Beta</span><span class="op">$</span><span class="va">Env</span> <span class="op">&lt;-</span> <span class="va">envs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">BLUEL</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ans1</span><span class="op">$</span><span class="va">Beta</span></span>
<span>  <span class="co"># to be comparable to 1/(se^2) = 1/PEV = 1/Ci = 1/[(X'X)inv]</span></span>
<span>  <span class="va">XtXL</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">ans1</span><span class="op">$</span><span class="va">VarBeta</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">DT2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">BLUEL</span><span class="op">)</span></span>
<span><span class="va">OM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">adiag1</span>,<span class="va">XtXL</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##########</span></span>
<span><span class="co">## stage 2</span></span>
<span><span class="co">## use mmec for sparse equation</span></span>
<span><span class="co">##########</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">$</span><span class="va">Estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmec.html">mmec</a></span><span class="op">(</span><span class="va">Estimate</span><span class="op">~</span><span class="va">Env</span>,</span>
<span>             random<span class="op">=</span><span class="op">~</span><span class="va">Effect</span> <span class="op">+</span> <span class="va">Env</span><span class="op">:</span><span class="va">Effect</span>, </span>
<span>             rcov<span class="op">=</span><span class="op">~</span><span class="fu"><a href="../reference/vsc.html">vsc</a></span><span class="op">(</span><span class="fu"><a href="../reference/isc.html">isc</a></span><span class="op">(</span><span class="va">units</span>,thetaC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, theta <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             W<span class="op">=</span><span class="va">OM</span>, </span>
<span>             verbose<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>             data<span class="op">=</span><span class="va">DT2</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using the weights matrix</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ans2</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                     VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## Effect:isc:isc     2.076920 0.5758219  3.606880   Positive</span></span>
<span><span class="co">## Env:Effect:isc:isc 3.333792 0.1850479 18.015831   Positive</span></span>
<span><span class="co">## units:m:           1.000000 0.1850479  5.404005      Fixed</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>Covarrubias-Pazaran G. 2016. Genome assisted prediction of
quantitative traits using the R package sommer. PLoS ONE 11(6):1-15.</p>
<p>Covarrubias-Pazaran G. 2018. Software update: Moving the R package
sommer to multivariate mixed models for genome-assisted prediction. doi:
<a href="https://doi.org/10.1101/354639" class="external-link uri">https://doi.org/10.1101/354639</a></p>
<p>Bernardo Rex. 2010. Breeding for quantitative traits in plants.
Second edition. Stemma Press. 390 pp.</p>
<p>Gilmour et al. 1995. Average Information REML: An efficient algorithm
for variance parameter estimation in linear mixed models. Biometrics
51(4):1440-1450.</p>
<p>Henderson C.R. 1975. Best Linear Unbiased Estimation and Prediction
under a Selection Model. Biometrics vol. 31(2):423-447.</p>
<p>Kang et al. 2008. Efficient control of population structure in model
organism association mapping. Genetics 178:1709-1723.</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models and nested
bases. Computational Statistics and Data Analysis, 61, 22 - 37.</p>
<p>Lee et al. 2015. MTG2: An efficient algorithm for multivariate linear
mixed model analysis based on genomic information. Cold Spring Harbor.
doi: <a href="http://dx.doi.org/10.1101/027201" class="external-link uri">http://dx.doi.org/10.1101/027201</a>.</p>
<p>Maier et al. 2015. Joint analysis of psychiatric disorders increases
accuracy of risk prediction for schizophrenia, bipolar disorder, and
major depressive disorder. Am J Hum Genet; 96(2):283-294.</p>
<p>Rodriguez-Alvarez, Maria Xose, et al. Correcting for spatial
heterogeneity in plant breeding experiments with P-splines. Spatial
Statistics 23 (2018): 52-71.</p>
<p>Searle. 1993. Applying the EM algorithm to calculating ML and REML
estimates of variance components. Paper invited for the 1993 American
Statistical Association Meeting, San Francisco.</p>
<p>Yu et al. 2006. A unified mixed-model method for association mapping
that accounts for multiple levels of relatedness. Genetics
38:203-208.</p>
<p>Tunnicliffe W. 1989. On the use of marginal likelihood in time series
model estimation. JRSS 51(1):15-27.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
