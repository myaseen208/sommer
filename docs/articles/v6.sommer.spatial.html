<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Spatial modeling using the sommer package • sommer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial modeling using the sommer package">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatial modeling using the sommer package</h1>
                        <h4 data-toc-skip class="author">Giovanny
Covarrubias-Pazaran</h4>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/covaruber/sommer/blob/HEAD/vignettes/v6.sommer.spatial.Rmd"><code>vignettes/v6.sommer.spatial.Rmd</code></a></small>
      <div class="d-none name"><code>v6.sommer.spatial.Rmd</code></div>
    </div>

    
    
<p>The sommer package was developed to provide R users with a powerful
and reliable multivariate mixed model solver for different genetic (in
diploid and polyploid organisms) and non-genetic analyses. This package
allows the user to estimate variance components in a mixed model with
the advantages of specifying the variance-covariance structure of the
random effects, specifying heterogeneous variances, and obtaining other
parameters such as BLUPs, BLUEs, residuals, fitted values, variances for
fixed and random effects, etc. The core algorithms of the package are
coded in C++ using the Armadillo library to optimize dense matrix
operations common in the derect-inversion algorithms.</p>
<p>This vignette is focused on showing the capabilities of sommer to fit
spatial models using the two dimensional splines models.</p>
<p><strong>SECTION 1: Introduction </strong></p>
<ol style="list-style-type: decimal">
<li>Background in tensor products</li>
</ol>
<p><strong>SECTION 2: Spatial models</strong></p>
<ol style="list-style-type: decimal">
<li>Two dimensional splines (multiple spatial components)</li>
<li>Two dimensional splines (single spatial component)</li>
<li>Spatial models in multiple trials at once</li>
</ol>
<div class="section level2">
<h2 id="section-1-introduction">SECTION 1: Introduction<a class="anchor" aria-label="anchor" href="#section-1-introduction"></a>
</h2>
<div class="section level3">
<h3 id="backgrounds-in-tensor-products">Backgrounds in tensor products<a class="anchor" aria-label="anchor" href="#backgrounds-in-tensor-products"></a>
</h3>
<p>TBD</p>
</div>
</div>
<div class="section level2">
<h2 id="section-2-spatial-models">SECTION 2: Spatial models<a class="anchor" aria-label="anchor" href="#section-2-spatial-models"></a>
</h2>
<div class="section level3">
<h3 id="two-dimensional-splines-multiple-spatial-components">1) Two dimensional splines (multiple spatial components)<a class="anchor" aria-label="anchor" href="#two-dimensional-splines-multiple-spatial-components"></a>
</h3>
<p>In this example we show how to obtain the same results than using the
SpATS package. This is achieved by using the <code>spl2Db</code>
function which is a wrapper of the <code>tpsmmb</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/covaruber/sommer">sommer</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: MASS</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: crayon</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_yatesoats</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_yatesoats</span></span>
<span><span class="va">DT</span><span class="op">$</span><span class="va">row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">row</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">$</span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">col</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">$</span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">row</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">$</span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">col</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SPATS MODEL</span></span>
<span><span class="co"># m1.SpATS &lt;- SpATS(response = "Y",</span></span>
<span><span class="co">#                   spatial = ~ PSANOVA(col, row, nseg = c(14,21), degree = 3, pord = 2),</span></span>
<span><span class="co">#                   genotype = "V", fixed = ~ 1,</span></span>
<span><span class="co">#                   random = ~ R + C, data = DT,</span></span>
<span><span class="co">#                   control = list(tolerance = 1e-04))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># summary(m1.SpATS, which = "variances")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Spatial analysis of trials with splines </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Response:                   Y         </span></span>
<span><span class="co"># Genotypes (as fixed):       V         </span></span>
<span><span class="co"># Spatial:                    ~PSANOVA(col, row, nseg = c(14, 21), degree = 3, pord = 2)</span></span>
<span><span class="co"># Fixed:                      ~1        </span></span>
<span><span class="co"># Random:                     ~R + C    </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Number of observations:        72</span></span>
<span><span class="co"># Number of missing data:        0</span></span>
<span><span class="co"># Effective dimension:           17.09</span></span>
<span><span class="co"># Deviance:                      483.405</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Variance components:</span></span>
<span><span class="co">#                   Variance            SD     log10(lambda)</span></span>
<span><span class="co"># R                 1.277e+02     1.130e+01           0.49450</span></span>
<span><span class="co"># C                 2.673e-05     5.170e-03           7.17366</span></span>
<span><span class="co"># f(col)            4.018e-15     6.339e-08          16.99668</span></span>
<span><span class="co"># f(row)            2.291e-10     1.514e-05          12.24059</span></span>
<span><span class="co"># f(col):row        1.025e-04     1.012e-02           6.59013</span></span>
<span><span class="co"># col:f(row)        8.789e+01     9.375e+00           0.65674</span></span>
<span><span class="co"># f(col):f(row)     8.036e-04     2.835e-02           5.69565</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Residual          3.987e+02     1.997e+01 </span></span>
<span></span>
<span><span class="co"># SOMMER MODEL</span></span>
<span><span class="va">m1.sommer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">V</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="../reference/spl2Db.html">spl2Db</a></span><span class="op">(</span><span class="va">col</span>,<span class="va">row</span>, nsegments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">21</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>                           penaltyord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, what <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span>, </span>
<span>                  random <span class="op">=</span> <span class="op">~</span><span class="va">R</span><span class="op">+</span><span class="va">C</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="../reference/spl2Db.html">spl2Db</a></span><span class="op">(</span><span class="va">col</span>,<span class="va">row</span>, nsegments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">21</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>                           penaltyord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, what<span class="op">=</span><span class="st">"bits"</span><span class="op">)</span>,</span>
<span>                  data<span class="op">=</span><span class="va">DT</span>, tolParConv <span class="op">=</span> <span class="fl">1e-6</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: fixed-effect model matrix is rank deficient so dropping 8 columns / coefficients</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1.sommer</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                VarComp VarCompSE     Zratio Constraint</span></span>
<span><span class="co">## R.Y-Y       125.928235  89.77330  1.4027360   Positive</span></span>
<span><span class="co">## C.Y-Y        -7.789528  24.29529 -0.3206189   Positive</span></span>
<span><span class="co">## A:fC.Y-Y      0.000000  19.09624  0.0000000   Positive</span></span>
<span><span class="co">## A:fR.Y-Y      0.000000  15.87659  0.0000000   Positive</span></span>
<span><span class="co">## A:fC.R.Y-Y    0.000000  21.42763  0.0000000   Positive</span></span>
<span><span class="co">## A:C.fR.Y-Y   82.177296  92.28630  0.8904604   Positive</span></span>
<span><span class="co">## A:fC.fR.Y-Y   0.000000  25.46390  0.0000000   Positive</span></span>
<span><span class="co">## units.Y-Y   405.900386  90.48195  4.4859820   Positive</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the fitted values for the spatial kernel and plot</span></span>
<span><span class="co"># ff &lt;- fitted.mmer(m1.sommer)</span></span>
<span><span class="co"># DT$fit &lt;- as.matrix(Reduce("+",ff$Zu[-c(1:2)])) </span></span>
<span><span class="co"># lattice::levelplot(fit~row*col,data=DT)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="two-dimensional-splines-single-spatial-component">2) Two dimensional splines (single spatial component)<a class="anchor" aria-label="anchor" href="#two-dimensional-splines-single-spatial-component"></a>
</h3>
<p>To reduce the computational burden of fitting multiple spatial
kernels <code>sommer</code> provides a single spatial kernel method
through the <code>spl2Da</code> function. This as will be shown, can
produce similar results to the more flexible model. Use the one that
fits better your needs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SOMMER MODEL</span></span>
<span><span class="va">m2.sommer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">V</span>, </span>
<span>                  random <span class="op">=</span> <span class="op">~</span><span class="va">R</span><span class="op">+</span><span class="va">C</span><span class="op">+</span><span class="fu"><a href="../reference/spl2Da.html">spl2Da</a></span><span class="op">(</span><span class="va">col</span>,<span class="va">row</span>, nsegments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">21</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, penaltyord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  data<span class="op">=</span><span class="va">DT</span>, tolParConv <span class="op">=</span> <span class="fl">1e-6</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1.sommer</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##                VarComp VarCompSE     Zratio Constraint</span></span>
<span><span class="co">## R.Y-Y       125.928235  89.77330  1.4027360   Positive</span></span>
<span><span class="co">## C.Y-Y        -7.789528  24.29529 -0.3206189   Positive</span></span>
<span><span class="co">## A:fC.Y-Y      0.000000  19.09624  0.0000000   Positive</span></span>
<span><span class="co">## A:fR.Y-Y      0.000000  15.87659  0.0000000   Positive</span></span>
<span><span class="co">## A:fC.R.Y-Y    0.000000  21.42763  0.0000000   Positive</span></span>
<span><span class="co">## A:C.fR.Y-Y   82.177296  92.28630  0.8904604   Positive</span></span>
<span><span class="co">## A:fC.fR.Y-Y   0.000000  25.46390  0.0000000   Positive</span></span>
<span><span class="co">## units.Y-Y   405.900386  90.48195  4.4859820   Positive</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the fitted values for the spatial kernel and plot</span></span>
<span><span class="co"># ff &lt;- fitted.mmer(m2.sommer)</span></span>
<span><span class="co"># DT$fit &lt;- as.matrix(Reduce("+",ff$Zu[-c(1:2)])) </span></span>
<span><span class="co"># lattice::levelplot(fit~row*col,data=DT)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-models-in-multiple-trials-at-once">3) Spatial models in multiple trials at once<a class="anchor" aria-label="anchor" href="#spatial-models-in-multiple-trials-at-once"></a>
</h3>
<p>Sometimes we want to fit heterogeneous variance components when e.g.,
have multiple trials or different locations. The spatial models can also
be fitted that way using the <code>at.var</code> and
<code>at.levels</code> arguments. The first argument expects a variable
that will define the levels at which the variance components will be
fitted. The second argument is a way for the user to specify the levels
at which the spatial kernels should be fitted if the user doesn’t want
to fit it for all levels (e.g., trials or fields).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">DT</span>,<span class="va">DT</span><span class="op">)</span></span>
<span><span class="va">DT2</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">DT2</span><span class="op">$</span><span class="va">Y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DT2</span><span class="op">$</span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DT2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   row col         Y   N          V  B         MP R C trial</span></span>
<span><span class="co">## 1   1   1  89.59996 0.2    Victory B2    Victory 1 1     A</span></span>
<span><span class="co">## 2   2   1  61.25532   0    Victory B2    Victory 2 1     A</span></span>
<span><span class="co">## 3   3   1 118.56274 0.4 Marvellous B2 Marvellous 3 1     A</span></span>
<span><span class="co">## 4   4   1 143.99443 0.6 Marvellous B2 Marvellous 4 1     A</span></span>
<span><span class="co">## 5   5   1 149.62155 0.6 GoldenRain B2 GoldenRain 5 1     A</span></span>
<span><span class="co">## 6   6   1 109.14841 0.2 GoldenRain B2 GoldenRain 6 1     A</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SOMMER MODEL</span></span>
<span><span class="va">m3.sommer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmer.html">mmer</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">V</span>, </span>
<span>                  random <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsr.html">dsr</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span>,<span class="va">R</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsr.html">dsr</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span>,<span class="va">C</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="../reference/spl2Da.html">spl2Da</a></span><span class="op">(</span><span class="va">col</span>,<span class="va">row</span>, nsegments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">21</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>                           penaltyord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, at.var <span class="op">=</span> <span class="va">trial</span><span class="op">)</span>,</span>
<span>                  rcov <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="../reference/vsr.html">vsr</a></span><span class="op">(</span><span class="fu"><a href="../reference/dsr.html">dsr</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span>,<span class="va">units</span><span class="op">)</span>,</span>
<span>                  data<span class="op">=</span><span class="va">DT2</span>, tolParConv <span class="op">=</span> <span class="fl">1e-6</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m3.sommer</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code></pre></div>
<pre><code><span><span class="co">##               VarComp VarCompSE    Zratio Constraint</span></span>
<span><span class="co">## A:R.Y-Y     110.48977  84.54017 1.3069500   Positive</span></span>
<span><span class="co">## B:R.Y-Y      98.62245  79.02550 1.2479827   Positive</span></span>
<span><span class="co">## A:C.Y-Y     142.56456 137.96100 1.0333686   Positive</span></span>
<span><span class="co">## B:C.Y-Y     149.42401 141.84342 1.0534434   Positive</span></span>
<span><span class="co">## A:all.Y-Y   425.72702 906.61488 0.4695787   Positive</span></span>
<span><span class="co">## B:all.Y-Y   359.95531 871.18523 0.4131789   Positive</span></span>
<span><span class="co">## A:units.Y-Y 395.80463 208.91326 1.8945884   Positive</span></span>
<span><span class="co">## B:units.Y-Y 392.77959 202.73542 1.9374000   Positive</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the fitted values for the spatial kernel and plot</span></span>
<span><span class="co"># ff &lt;- fitted.mmer(m3.sommer)</span></span>
<span><span class="co"># DT2$fit &lt;- as.matrix(Reduce("+",ff$Zu[-c(1:4)])) </span></span>
<span><span class="co"># lattice::levelplot(fit~row*col|trial,data=DT2)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>Covarrubias-Pazaran G. 2016. Genome assisted prediction of
quantitative traits using the R package sommer. PLoS ONE 11(6):1-15.</p>
<p>Covarrubias-Pazaran G. 2018. Software update: Moving the R package
sommer to multivariate mixed models for genome-assisted prediction. doi:
<a href="https://doi.org/10.1101/354639" class="external-link uri">https://doi.org/10.1101/354639</a></p>
<p>Bernardo Rex. 2010. Breeding for quantitative traits in plants.
Second edition. Stemma Press. 390 pp.</p>
<p>Gilmour et al. 1995. Average Information REML: An efficient algorithm
for variance parameter estimation in linear mixed models. Biometrics
51(4):1440-1450.</p>
<p>Henderson C.R. 1975. Best Linear Unbiased Estimation and Prediction
under a Selection Model. Biometrics vol. 31(2):423-447.</p>
<p>Kang et al. 2008. Efficient control of population structure in model
organism association mapping. Genetics 178:1709-1723.</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models and nested
bases. Computational Statistics and Data Analysis, 61, 22 - 37.</p>
<p>Lee et al. 2015. MTG2: An efficient algorithm for multivariate linear
mixed model analysis based on genomic information. Cold Spring Harbor.
doi: <a href="http://dx.doi.org/10.1101/027201" class="external-link uri">http://dx.doi.org/10.1101/027201</a>.</p>
<p>Maier et al. 2015. Joint analysis of psychiatric disorders increases
accuracy of risk prediction for schizophrenia, bipolar disorder, and
major depressive disorder. Am J Hum Genet; 96(2):283-294.</p>
<p>Rodriguez-Alvarez, Maria Xose, et al. Correcting for spatial
heterogeneity in plant breeding experiments with P-splines. Spatial
Statistics 23 (2018): 52-71.</p>
<p>Searle. 1993. Applying the EM algorithm to calculating ML and REML
estimates of variance components. Paper invited for the 1993 American
Statistical Association Meeting, San Francisco.</p>
<p>Yu et al. 2006. A unified mixed-model method for association mapping
that accounts for multiple levels of relatedness. Genetics
38:203-208.</p>
<p>Tunnicliffe W. 1989. On the use of marginal likelihood in time series
model estimation. JRSS 51(1):15-27.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
