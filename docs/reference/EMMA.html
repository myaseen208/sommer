<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Multivariate Efficient Mixed Model Association Algorithm — MEMMA • sommer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate Efficient Mixed Model Association Algorithm — MEMMA"><meta name="description" content="This function is used internally in the function mmer when multiple responses are selected for a single variance component other than the error. It uses the efficient mixed model association (MEMMA) algorithm."><meta property="og:description" content="This function is used internally in the function mmer when multiple responses are selected for a single variance component other than the error. It uses the efficient mixed model association (MEMMA) algorithm."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multivariate Efficient Mixed Model Association Algorithm</h1>

      <div class="d-none name"><code>EMMA.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is used internally in the function <code><a href="mmer.html">mmer</a></code> when multiple responses are selected for a single variance component other than the error. It uses the efficient mixed model association (MEMMA) algorithm.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MEMMA</span><span class="op">(</span><span class="va">Y</span>, X<span class="op">=</span><span class="cn">NULL</span>, ZETA<span class="op">=</span><span class="cn">NULL</span>, tolpar <span class="op">=</span> <span class="fl">1e-06</span>, tolparinv <span class="op">=</span> <span class="fl">1e-06</span>, check.model<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>      silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>a numeric vector for the response variable</p></dd>

  <dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an incidence matrix for fixed effects.</p></dd>

  <dt id="arg-zeta">ZETA<a class="anchor" aria-label="anchor" href="#arg-zeta"></a></dt>
<dd><p>an incidence matrix for random effects. This can be for one or more random effects. This NEEDS TO BE PROVIDED AS A LIST STRUCTURE. For example Z=list(list(Z=Z1, K=K1), list(Z=Z2, K=K2), list(Z=Z3, K=K3)) makes a 2 level list for 3 random effects. The general idea is that each random effect with or without its variance-covariance structure is a list, i.e. list(Z=Z1, K=K1) where Z is the incidence matrix and K the var-cov matrix. When moving to more than one random effect we need to make several lists that need to be inside another list. What we call a 2-level list, i.e. list(Z=Z1, K=K1) and list(Z=Z2, K=K2) would need to be put in the form; list(list(Z=Z1, K=K1),list(Z=Z1, K=K1)), which as can be seen, is a list of lists (2-level list).</p></dd>

  <dt id="arg-tolpar">tolpar<a class="anchor" aria-label="anchor" href="#arg-tolpar"></a></dt>
<dd><p>tolerance parameter for convergence</p></dd>

  <dt id="arg-tolparinv">tolparinv<a class="anchor" aria-label="anchor" href="#arg-tolparinv"></a></dt>
<dd><p>tolerance parameter for matrix inverse</p></dd>

  <dt id="arg-check-model">check.model<a class="anchor" aria-label="anchor" href="#arg-check-model"></a></dt>
<dd><p>a TRUE/FALSE value indicating if list structure provided by the user is correct to fix it. The default is TRUE but is turned off to FALSE within the mmer function which would imply a double check.</p></dd>

  <dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>a TRUE/FALSE value indicating if the function should draw the progress bar or iterations performed while working or should not be displayed.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>.</p>
<p>The likelihood function optimized in this algorithm is:</p>
<p>.</p>
<p>logL = (n - p) * log(sum(eta^2/(lambda + delta)) + sum(log(lambda + delta))</p>
<p>.</p>
<p>where:
(n-p)  refers to the degrees of freedom
lambda are the eigenvalues mentioned by Kang et al.(2008)
delta is the REML estimator of the ridge parameter</p>
<p>.</p>
<p>The algorithm can be summarized in the next steps:</p>
<p>.</p>
<p>1) provide initial value for the ridge parameter</p>
<p>2) estimate S = I - X(X'X)-X'</p>
<p>3) obtain the phenotypic variance V = ZKZ' + delta.prov*I</p>
<p>4) perform an eigen decomposition of SVS</p>
<p>5) create "lambda"" as the eigenvalues of SVS and "U"" as the eigenvectors</p>
<p>6) estimate eta=U'y</p>
<p>7) optimize the likelihood shown above providing "eta", "lambdas" and optimize with respect to "delta" which is the ridge parameter and contains Ve/Vu</p>


    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If all parameters are correctly indicated the program will return a list with the following information:</p><dl><dt>$Vu</dt>
<dd><p>a scalar value for the variance component estimated</p></dd>

<dt>$Ve</dt>
<dd><p>a scalar value for the error variance estimated</p></dd>

<dt>$V.inv</dt>
<dd><p>a matrix with the inverse of the phenotypic variance V = ZGZ+R, V^-1</p></dd>

<dt>$u.hat</dt>
<dd><p>a vector with BLUPs for random effects</p></dd>

<dt>$Var.u.hat</dt>
<dd><p>a vector with variances for BLUPs</p></dd>

<dt>$PEV.u.hat</dt>
<dd><p>a vector with predicted error variance for BLUPs</p></dd>

<dt>$beta.hat</dt>
<dd><p>a vector for BLUEs of fixed effects</p></dd>

<dt>$Var.beta.hat</dt>
<dd><p>a vector with variances for BLUEs</p></dd>

<dt>$X</dt>
<dd><p>incidence matrix for fixed effects, if not passed is assumed to only include the intercept</p></dd>

<dt>$Z</dt>
<dd><p>incidence matrix for random effects, if not passed is assumed to be a diagonal matrix</p></dd>

<dt>$K</dt>
<dd><p>the var-cov matrix for the random effect fitted in Z</p></dd>

<dt>$ll</dt>
<dd><p>the log-likelihood value for obtained when optimizing the likelihood function when using ML or REML</p></dd>



</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>


<p>Kang et al. 2008. Efficient control of population structure in model organism association mapping. Genetics 178:1709-1723.</p>
<p>Covarrubias-Pazaran G (2016) Genome assisted prediction of quantitative traits using the R package sommer. PLoS ONE 11(6): doi:10.1371/journal.pone.0156744</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The core functions of the package <code><a href="mmer.html">mmer</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####=========================================####</span></span></span>
<span class="r-in"><span><span class="co">#### For CRAN time limitations most lines in the </span></span></span>
<span class="r-in"><span><span class="co">#### examples are silenced with one '#' mark, </span></span></span>
<span class="r-in"><span><span class="co">#### remove them and run the examples</span></span></span>
<span class="r-in"><span><span class="co">####=========================================####</span></span></span>
<span class="r-in"><span><span class="co"># data(CPdata)</span></span></span>
<span class="r-in"><span><span class="co"># DT &lt;- DT_cpdata</span></span></span>
<span class="r-in"><span><span class="co"># GT &lt;- GT_cpdata</span></span></span>
<span class="r-in"><span><span class="co"># MP &lt;- MP_cpdata</span></span></span>
<span class="r-in"><span><span class="co"># ### look at the data</span></span></span>
<span class="r-in"><span><span class="co"># head(DT)</span></span></span>
<span class="r-in"><span><span class="co"># GT[1:5,1:5]</span></span></span>
<span class="r-in"><span><span class="co"># ## fit a model including additive and dominance effects</span></span></span>
<span class="r-in"><span><span class="co"># Y &lt;- DT[,c("color","Yield")]</span></span></span>
<span class="r-in"><span><span class="co"># Za &lt;- diag(dim(Y)[1])</span></span></span>
<span class="r-in"><span><span class="co"># A &lt;- A.mat(GT) # additive relationship matrix</span></span></span>
<span class="r-in"><span><span class="co"># ####================####</span></span></span>
<span class="r-in"><span><span class="co"># #### ADDITIVE MODEL ####</span></span></span>
<span class="r-in"><span><span class="co"># ####================####</span></span></span>
<span class="r-in"><span><span class="co"># ETA.A &lt;- list(add=list(Z=Za,K=A))</span></span></span>
<span class="r-in"><span><span class="co"># #ans.A &lt;- MEMMA(Y=Y, ZETA=ETA.A)</span></span></span>
<span class="r-in"><span><span class="co"># #ans.A$var.comp</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

