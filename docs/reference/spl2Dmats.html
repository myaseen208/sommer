<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Get Tensor Product Spline Mixed Model Incidence Matrices — spl2Dmats • sommer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Tensor Product Spline Mixed Model Incidence Matrices — spl2Dmats"><meta name="description" content="spl2Dmats gets Tensor-Product P-Spline Mixed Model Incidence Matrices
    for use with sommer and its main function mmer. We thank Sue Welham for making the TPSbits package available to the community. If you're using this function for your research please cite her TPSbits package :) this is mostly a wrapper of her tpsmmb function to enable the use in sommer."><meta property="og:description" content="spl2Dmats gets Tensor-Product P-Spline Mixed Model Incidence Matrices
    for use with sommer and its main function mmer. We thank Sue Welham for making the TPSbits package available to the community. If you're using this function for your research please cite her TPSbits package :) this is mostly a wrapper of her tpsmmb function to enable the use in sommer."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Tensor Product Spline Mixed Model Incidence Matrices</h1>

      <div class="d-none name"><code>spl2Dmats.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>spl2Dmats</code> gets Tensor-Product P-Spline Mixed Model Incidence Matrices
    for use with <code>sommer</code> and its main function <code>mmer</code>. We thank Sue Welham for making the TPSbits package available to the community. If you're using this function for your research please cite her TPSbits package :) this is mostly a wrapper of her tpsmmb function to enable the use in sommer.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spl2Dmats</span><span class="op">(</span></span>
<span>  <span class="va">x.coord.name</span>,</span>
<span>  <span class="va">y.coord.name</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">at.name</span>,</span>
<span>  <span class="va">at.levels</span>, </span>
<span>  nsegments<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>  minbound<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>  maxbound<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>  degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  penaltyord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>  nestorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Lee"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x-coord-name">x.coord.name<a class="anchor" aria-label="anchor" href="#arg-x-coord-name"></a></dt>
<dd><p>A string. Gives the name of <code>data</code> element
holding column locations.</p></dd>


<dt id="arg-y-coord-name">y.coord.name<a class="anchor" aria-label="anchor" href="#arg-y-coord-name"></a></dt>
<dd><p>A string. Gives the name of <code>data</code> element
holding row locations.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A dataframe. Holds the dataset to be used for fitting.</p></dd>


<dt id="arg-at-name">at.name<a class="anchor" aria-label="anchor" href="#arg-at-name"></a></dt>
<dd><p>name of a variable defining if the 2D spline matrices should be created at different units (e.g., at different environments).</p></dd>


<dt id="arg-at-levels">at.levels<a class="anchor" aria-label="anchor" href="#arg-at-levels"></a></dt>
<dd><p>a vector of names indicating which levels of the at.name variable should be used for fitting the 2D spline function.</p></dd>


<dt id="arg-nsegments">nsegments<a class="anchor" aria-label="anchor" href="#arg-nsegments"></a></dt>
<dd><p>A list of length 2. Number of segments to split column and
row ranges into, respectively (= number of internal knots + 1). If only
one number is specified, that value is used in both dimensions. If not
specified, (number of unique values - 1) is used in each dimension;
for a grid layout (equal spacing) this gives a knot at each data value.</p></dd>


<dt id="arg-minbound">minbound<a class="anchor" aria-label="anchor" href="#arg-minbound"></a></dt>
<dd><p>A list of length 2. The lower bound to be used for column
and row dimensions respectively; default calculated as the minimum value
for each dimension.</p></dd>


<dt id="arg-maxbound">maxbound<a class="anchor" aria-label="anchor" href="#arg-maxbound"></a></dt>
<dd><p>A list of length 2. The upper bound to be used for column
and row dimensions respectively; default calculated as the maximum value
for each dimension.</p></dd>


<dt id="arg-degree">degree<a class="anchor" aria-label="anchor" href="#arg-degree"></a></dt>
<dd><p>A list of length 2. The degree of polynomial spline to be used
for column and row dimensions respectively; default=3.</p></dd>


<dt id="arg-penaltyord">penaltyord<a class="anchor" aria-label="anchor" href="#arg-penaltyord"></a></dt>
<dd><p>A list of length 2. The order of differencing for column
and row dimensions, respectively; default=2.</p></dd>


<dt id="arg-nestorder">nestorder<a class="anchor" aria-label="anchor" href="#arg-nestorder"></a></dt>
<dd><p>A list of length 2. The order of nesting for column and row
dimensions, respectively; default=1 (no nesting). A value of 2 generates
a spline with half the number of segments in that dimension, etc. The
number of segments in each direction must be a multiple of the order
of nesting.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>A string. Method for forming the  penalty; default=<code>"Lee"</code>
ie the penalty from Lee, Durban &amp; Eilers (2013, CSDA 61, 22-37). The
alternative method is <code>"Wood"</code> ie. the method from Wood et al (2012,
Stat Comp 23, 341-360).
This option is a research tool and requires further investigation.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List of length 7 elements:</p><ol><li><p><code>data</code> = the input data frame augmented with structures required
    to fit tensor product splines in <code>asreml-R</code>. This data frame can be used
    to fit the TPS model.</p>
<p>Added columns:</p><ul><li><p><code>TP.col</code>, <code>TP.row</code> = column and row coordinates</p></li>
<li><p><code>TP.CxR</code> = combined index for use with smooth x smooth term</p></li>
<li><p><code>TP.C.n</code> for n=1:(diff.c) = X parts of column spline for use
    in random model (where diff.c is the order of column differencing)</p></li>
<li><p><code>TP.R.n</code> for n=1:(diff.r) = X parts of row spline for use in
    random model (where diff.r is the order of row differencing)</p></li>
<li><p><code>TP.CR.n</code> for n=1:((diff.c*diff.r)) = interaction between the
    two X parts for use in fixed model. The first variate is
    a constant term which should be omitted from the model when the constant
    (1) is present. If all elements are
    included in the model then the constant term should be omitted,
    eg. <code>y ~ -1 + TP.CR.1 + TP.CR.2 + TP.CR.3 + TP.CR.4 + other terms...</code></p></li>
<li><p>when <code>asreml="grp"</code> or <code>"sepgrp"</code>, the spline basis
    functions are also added into the data frame. Column numbers for each
    term are given in the <code>grp</code> list structure.</p></li>
</ul></li>
<li><p><code>fR</code> = Xr1:Zc</p></li>
<li><p><code>fC</code> = Xr2:Zc</p></li>
<li><p><code>fR.C</code> = Zr:Xc1</p></li>
<li><p><code>R.fC</code> = Zr:Xc2</p></li>
<li><p><code>fR.fC</code> = Zc:Zr</p></li>
<li><p><code>all</code> = Xr1:Zc | Xr2:Zc | Zr:Xc1 | Zr:Xc2 | Zc:Zr</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"DT_cpdata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_cpdata</span></span></span>
<span class="r-in"><span><span class="va">GT</span> <span class="op">&lt;-</span> <span class="va">GT_cpdata</span></span></span>
<span class="r-in"><span><span class="va">MP</span> <span class="op">&lt;-</span> <span class="va">MP_cpdata</span></span></span>
<span class="r-in"><span><span class="co">#### create the variance-covariance matrix</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="A.mat.html">A.mat</a></span><span class="op">(</span><span class="va">GT</span><span class="op">)</span> <span class="co"># additive relationship matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu">spl2Dmats</span><span class="op">(</span>x.coord.name <span class="op">=</span> <span class="st">"Col"</span>, y.coord.name <span class="op">=</span> <span class="st">"Row"</span>, data<span class="op">=</span><span class="va">DT</span>, nseg <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">21</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">M</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               id Row Col Year      color  Yield FruitAver Firmness Rowf Colf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P003 P003   3   1 2014 0.10075269 154.67     41.93  588.917    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P004 P004   4   1 2014 0.13891940 186.77     58.79  640.031    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P005 P005   5   1 2014 0.08681502  80.21     48.16  671.523    5    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P006 P006   6   1 2014 0.13408561 202.96     48.24  687.172    6    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P007 P007   7   1 2014 0.13519278 174.74     45.83  601.322    7    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P008 P008   8   1 2014 0.17406685 194.16     44.63  656.379    8    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             FIELDINST TP.col TP.row TP.CxR    TP.C.1     TP.C.2    TP.R.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P003    FIELD1      1      3    103 0.2425356 -0.3465516 0.2041241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P004    FIELD1      1      4    104 0.2425356 -0.3465516 0.2041241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P005    FIELD1      1      5    105 0.2425356 -0.3465516 0.2041241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P006    FIELD1      1      6    106 0.2425356 -0.3465516 0.2041241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P007    FIELD1      1      7    107 0.2425356 -0.3465516 0.2041241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P008    FIELD1      1      8    108 0.2425356 -0.3465516 0.2041241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    TP.R.2    TP.CR.1       TP.CR.2     TP.CR.3       TP.CR.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P003 -2.064187e-01 0.04950738 -5.006390e-02 -0.07073956  7.153475e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P004 -1.548141e-01 0.04950738 -3.754792e-02 -0.07073956  5.365106e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P005 -1.032094e-01 0.04950738 -2.503195e-02 -0.07073956  3.576738e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P006 -5.160468e-02 0.04950738 -1.251597e-02 -0.07073956  1.788369e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P007 -1.343925e-13 0.04950738 -3.259497e-14 -0.07073956  4.657394e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FIELD1.P008  5.160468e-02 0.04950738  1.251597e-02 -0.07073956 -1.788369e-02</span>
<span class="r-in"><span><span class="co"># m1g &lt;- mmer(Yield~1+TP.CR.2+TP.CR.3+TP.CR.4,</span></span></span>
<span class="r-in"><span><span class="co">#             random=~Rowf+Colf+vsr(M$fC)+vsr(M$fR)+</span></span></span>
<span class="r-in"><span><span class="co">#               vsr(M$fC.R)+vsr(M$C.fR)+vsr(M$fC.fR)+</span></span></span>
<span class="r-in"><span><span class="co">#               vsr(id,Gu=A),</span></span></span>
<span class="r-in"><span><span class="co">#             data=M$data, tolpar = 1e-6,</span></span></span>
<span class="r-in"><span><span class="co">#             iters=30)</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># summary(m1g)$varcomp</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

