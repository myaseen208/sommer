<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>variance structure specification — vs • sommer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="variance structure specification — vs"><meta name="description" content="vs is the main function to build the variance-covariance structure for the random effects to be fitted in the mmer solver."><meta property="og:description" content="vs is the main function to build the variance-covariance structure for the random effects to be fitted in the mmer solver."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>variance structure specification</h1>

      <div class="d-none name"><code>vs.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>vs</code> is the main function to build the variance-covariance structure for the random effects to be fitted in the <code><a href="mmer.html">mmer</a></code> solver.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">vs</span><span class="op">(</span><span class="va">...</span>, Gu<span class="op">=</span><span class="cn">NULL</span>, Gti<span class="op">=</span><span class="cn">NULL</span>, Gtc<span class="op">=</span><span class="cn">NULL</span>, reorderGu<span class="op">=</span><span class="cn">TRUE</span>, buildGu<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>variance structure to be specified following the logic desired in the internal kronecker product. For example, if user wants to define a diagonal variance structure for the random effect 'genotypes'(g) with respect to a random effect 'environments'(e), this is:</p>
<p><code>var(g) = G.e @ I.g</code></p>
<p>being <code>G.e</code>  a matrix containing the variance covariance components for g (genotypes) in each level of e (environments), <code>I.g</code> is the covariance among levels of g (genotypes; i.e. relationship matrix), and @ is the kronecker product. This would be specified in the mmer solver as:</p>
<p><code>random=~vs(dsr(e),g)</code></p>
<p>One strength of sommer is the ability to specify very complex structures with as many kronecker products as desired. For example:</p>
<p><code>var(g) = G.e @ G.f @ G.h @ I.g</code></p>
<p>is equivalent to</p>
<p><code>random=~vs(e,f,h,g)</code></p>
<p>where different covariance structures can be applied to the levels of <code>e,f,h</code> (i.e. <code><a href="dsr.html">dsr</a></code>, <code><a href="usr.html">usr</a></code>, <code><a href="csr.html">csr</a></code>, <code><a href="atr.html">atr</a></code> or a combination of these). For more examples please see the vignettes 'sommer.start' available in the package.</p></dd>


  <dt id="arg-gu">Gu<a class="anchor" aria-label="anchor" href="#arg-gu"></a></dt>
<dd><p>matrix with the known variance-covariance values for the levels of the u.th random effect (i.e. relationship matrix among individuals or any other known covariance matrix). If <code>NULL</code>, then an identity matrix is assumed. The Gu matrix can have more levels than the ones present in the random effect linked to it but not the other way around. Otherwise, an error message of missing level in Gu will be returned.</p></dd>


  <dt id="arg-gti">Gti<a class="anchor" aria-label="anchor" href="#arg-gti"></a></dt>
<dd><p>matrix with dimensions t x t (t equal to number of traits) with initial values of the variance-covariance components for the random effect specified in the .... argument. If <code>NULL</code> the program will provide the initial values. The values need to be scaled, see Details section.</p></dd>


  <dt id="arg-gtc">Gtc<a class="anchor" aria-label="anchor" href="#arg-gtc"></a></dt>
<dd><p>matrix with dimensions t x t (t equal to number of traits) of constraints for the variance-covariance components for the random effect specified in the ... argument according to the following rules:</p>
<p><code>0: not to be estimated</code></p>
<p><code>1: estimated and constrained to be positive (i.e. variance component)</code></p>
<p><code>2: estimated and unconstrained (can be negative or positive, i.e. covariance component)</code></p>
<p><code>3: not to be estimated but fixed (value has to be provided in the Gti argument)</code></p>
<p>In the multi-response scenario if the user doesn't specify this argument the default is to build an unstructured matrix (using the <code><a href="unsm.html">unsm</a></code>() function). This argument needs to be used wisely since some covariance among responses may not make sense. Useful functions to specify constraints are; <code><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></code>(), <code><a href="unsm.html">unsm</a></code>(), <code><a href="fixm.html">fixm</a></code>().</p></dd>


  <dt id="arg-reordergu">reorderGu<a class="anchor" aria-label="anchor" href="#arg-reordergu"></a></dt>
<dd><p>a <code>TRUE/FALSE</code> statement if the Gu matrix should be reordered based on the names of the design matrix of the random effect or passed with the custom order of the user. This may be important when fitting covariance components in a customized fashion. Only for advanced users.</p></dd>


    <dt id="arg-buildgu">buildGu<a class="anchor" aria-label="anchor" href="#arg-buildgu"></a></dt>
<dd><p>a <code>TRUE/FALSE</code> statement to indicate if the Gu matrix should be built in R when the value for the argument <code>Gu=NULL</code>. Repeat, only when when the value for the argument <code>Gu</code> is equal to <code>NULL</code>. In some cases when the incidence matrix is wide (e.g. rrBLUP models) the covariance structure is a huge p x p matrix that can be avoided when performing matrix operations. By setting this argument to <code>FALSE</code> it allows to skip forming this covariance matrix.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When providing initial values in the <code>Gti</code> argument the user has to provide scaled variance component values. The user can provide values from a previous model by accessing the <code>sigma_scaled</code> output from an <code>mmer</code> model or if an specific value is desired the user can obtain the scaled value as:</p>
<p><code>m = x/var(y)</code></p>
<p>where <code>x</code> is the desired initial value and <code>y</code> is the response variable. You can find an example in the <code><a href="DT_cpdata.html">DT_cpdata</a></code> dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p></p><dl><dt>$res</dt>
<dd><p>a list with all neccesary elements (incidence matrices, known var-cov structures, unknown covariance structures to be estimated and constraints) to be used in the mmer solver.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Covarrubias-Pazaran G (2016) Genome assisted prediction of quantitative traits using the R package sommer. PLoS ONE 11(6): doi:10.1371/journal.pone.0156744</p>
<p>Covarrubias-Pazaran G (2018) Software update: Moving the R package sommer to
  multivariate mixed models for genome-assisted prediction. doi:
  https://doi.org/10.1101/354639</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Giovanny Covarrubias-Pazaran</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The core function of the package: <code><a href="mmer.html">mmer</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Please use the function vsr() for mmer() and vsc() for mmec.</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

