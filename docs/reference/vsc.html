<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>variance structure specification — vsc • sommer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="variance structure specification — vsc"><meta name="description" content="vsc is the main function to build the variance-covariance structure for the random effects to be fitted in the mmec solver."><meta property="og:description" content="vsc is the main function to build the variance-covariance structure for the random effects to be fitted in the mmec solver."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116716530-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116716530-2');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sommer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">4.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-code"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-o"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/v1.sommer.quick.start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/v2.sommer.changes.and.faqs.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/v3.sommer.qg.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/v4.sommer.gxe.html">GxE models</a></li>
    <li><a class="dropdown-item" href="../articles/v5.sommer.vs.lme4.html">sommer vs lme4</a></li>
    <li><a class="dropdown-item" href="../articles/v6.sommer.spatial.html">Spatial</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="https://github.com/covaruber/sommer" aria-label="GitHub repository"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>variance structure specification</h1>

      <div class="d-none name"><code>vsc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>vsc</code> is the main function to build the variance-covariance structure for the random effects to be fitted in the <code><a href="mmec.html">mmec</a></code> solver.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">vsc</span><span class="op">(</span><span class="va">...</span>, Gu<span class="op">=</span><span class="cn">NULL</span>, buildGu<span class="op">=</span><span class="cn">TRUE</span>, meN<span class="op">=</span><span class="fl">1</span>, meTheta<span class="op">=</span><span class="cn">NULL</span>, meThetaC<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>      sp<span class="op">=</span><span class="cn">FALSE</span>, isFixed<span class="op">=</span><span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>variance structure to be specified following the logic desired in the internal kronecker product. For example, if user wants to define a diagonal variance structure for the random effect 'genotypes'(g) with respect to a random effect 'environments'(e), this is:</p>
<p><code>var(g) = G.e @ I.g</code></p>
<p>being <code>G.e</code>  a matrix containing the variance covariance components for g (genotypes) in each level of e (environments), <code>I.g</code> is the covariance among levels of g (genotypes; i.e. relationship matrix), and @ is the kronecker product. This would be specified in the mmec solver as:</p>
<p><code>random=~vsc(dsc(e),g)</code></p>
<p>One strength of sommer is the ability to specify very complex structures with as many kronecker products as desired. For example:</p>
<p><code>var(g) = G.e @ G.f @ G.h @ I.g</code></p>
<p>is equivalent to</p>
<p><code>random=~vsc(e,f,h,g)</code></p>
<p>where different covariance structures can be applied to the levels of <code>e,f,h</code> (i.e. <code><a href="dsc.html">dsc</a></code>, <code><a href="usc.html">usc</a></code>, <code><a href="csc.html">csc</a></code>, <code><a href="atr.html">atr</a></code> or a combination of these). For more examples please see the vignettes 'sommer.start' available in the package.</p></dd>


  <dt id="arg-gu">Gu<a class="anchor" aria-label="anchor" href="#arg-gu"></a></dt>
<dd><p>matrix with the inverse of a known variance-covariance values for the levels of the u.th random effect (e.g., the inverse of a relationship matrix among individuals or any other known inverse covariance matrix). If <code>NULL</code>, then an identity matrix is assumed. The Gu matrix can have more levels than the ones present in the random effect linked to it but not the other way around. Otherwise, an error message of missing level in Gu will be returned.</p></dd>


    <dt id="arg-buildgu">buildGu<a class="anchor" aria-label="anchor" href="#arg-buildgu"></a></dt>
<dd><p>a <code>TRUE/FALSE</code> statement to indicate if the Gu matrix should be built in R when the value for the argument <code>Gu=NULL</code>. Repeat, only when when the value for the argument <code>Gu</code> is equal to <code>NULL</code>. In some cases when the incidence matrix is wide (e.g. rrBLUP models) the covariance structure is a huge p x p matrix that can be avoided when performing matrix operations. By setting this argument to <code>FALSE</code> it allows to skip forming this covariance matrix.</p></dd>


   <dt id="arg-men">meN<a class="anchor" aria-label="anchor" href="#arg-men"></a></dt>
<dd><p>number of main effects in the variance structure. Is always counted from last to first.</p></dd>


   <dt id="arg-metheta">meTheta<a class="anchor" aria-label="anchor" href="#arg-metheta"></a></dt>
<dd><p>variance covariance matrix between the main effects desired. Just to be modified if the number of main effects is greater of 1 (e.g., indirect genetic effects).</p></dd>


   <dt id="arg-methetac">meThetaC<a class="anchor" aria-label="anchor" href="#arg-methetac"></a></dt>
<dd><p>constraints for the variance covariance matrix between the main effects desired. Just to be modified if the number of main effects is greater of 1 (e.g., indirect genetic effects).</p></dd>


   <dt id="arg-sp">sp<a class="anchor" aria-label="anchor" href="#arg-sp"></a></dt>
<dd><p>a TRUE/FALSE statement to indicate if the VC from this structure should be multiplied by the scale parameter added in the mmec function through the addScaleParam argument in the <code>mmec</code> function .</p></dd>


   <dt id="arg-isfixed">isFixed<a class="anchor" aria-label="anchor" href="#arg-isfixed"></a></dt>
<dd><p>a TRUE/FALSE statement to indicate if the vsc function is being used in the fixed part of the model. When TRUE, the function only returns the model matrix to avoid any error messages associated to returning all elements for a random effect. FALSE is the default since it is assumed to be used for a variance structure in a random effect.</p></dd>


   <dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>a TRUE/FALSE statement to indicate if messages should be printed when special situations accur. For example, adding unphenotyped individuals to the incidence matrices when present in the relationship  matrices.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>...</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p></p><dl><dt>$res</dt>
<dd><p>a list with all neccesary elements (incidence matrices, known var-cov structures, unknown covariance structures to be estimated and constraints) to be used in the mmec solver.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Covarrubias-Pazaran G (2016) Genome assisted prediction of quantitative traits using the R package sommer. PLoS ONE 11(6): doi:10.1371/journal.pone.0156744</p>
<p>Covarrubias-Pazaran G (2018) Software update: Moving the R package sommer to
  multivariate mixed models for genome-assisted prediction. doi:
  https://doi.org/10.1101/354639</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Giovanny Covarrubias-Pazaran</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The core function of the package: <code><a href="mmec.html">mmec</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DT_example</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT_example</span></span></span>
<span class="r-in"><span><span class="va">DT</span><span class="op">=</span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A_example</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Name</span>, <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co">## example without structure</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28 x 5 sparse Matrix of class "dgCMatrix"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    AC03433-1W MSK061-4 MSL007-B MSR169-8Y NY148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           .        .        1         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           .        .        1         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           .        1        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           .        1        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           .        .        .         1     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           .        .        .         .     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7           .        .        .         1     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8           1        .        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9           1        .        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10          .        .        .         .     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          .        1        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          .        .        .         1     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13          .        1        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          .        .        1         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15          .        .        1         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16          .        .        .         .     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17          1        .        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18          .        .        .         1     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19          1        .        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20          .        .        .         .     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21          .        .        .         1     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22          .        .        1         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23          .        .        1         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24          .        .        .         1     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25          1        .        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26          1        .        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27          .        1        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28          .        1        .         .     .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $thetaC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     isc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> isc   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      isc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> isc 0.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span></span>
<span class="r-in"><span>            random<span class="op">=</span> <span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            rcov<span class="op">=</span><span class="op">~</span> <span class="va">units</span>,</span></span>
<span class="r-in"><span>            nIters<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>            data<span class="op">=</span><span class="va">DT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration    LogLik     wall    cpu(sec)   restrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1      -36.5805   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2      -36.4695   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3      -36.3832   1:17:26      0           0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co">## example to without structure but</span></span></span>
<span class="r-in"><span><span class="co">## using covariance among levels in the</span></span></span>
<span class="r-in"><span><span class="co">## random effect Name</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="va">Ai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">A</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-4</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, Class<span class="op">=</span><span class="st">"dgCMatrix"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span></span>
<span class="r-in"><span>            random<span class="op">=</span> <span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, Gu<span class="op">=</span><span class="va">Ai</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            rcov<span class="op">=</span><span class="op">~</span> <span class="va">units</span>,</span></span>
<span class="r-in"><span>            nIters<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>            data<span class="op">=</span><span class="va">DT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adding additional levels of Gu in the model matrix of 'Name' </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration    LogLik     wall    cpu(sec)   restrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1      -36.5804   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2      -36.5226   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3      -36.4128   1:17:26      0           0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  VarComp VarCompSE   Zratio Constraint</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Name:Ai:isc:isc 1.519139  1.220564 1.244621   Positive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> units:isc:isc   4.261443  1.542953 2.761875   Positive</span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co">## example to use dsc() structure (DIAGONAL)</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dsc.html">dsc</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28 x 3 sparse Matrix of class "dgCMatrix"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2011 2012 2013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $thetaC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2011 2012 2013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2011    1    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2012    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2013    0    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2011 2012 2013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2011 0.15 0.00 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2012 0.00 0.15 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2013 0.00 0.00 0.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span></span>
<span class="r-in"><span>            random<span class="op">=</span> <span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="dsc.html">dsc</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>,<span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            rcov<span class="op">=</span><span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="dsc.html">dsc</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>,<span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            nIters<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>            data<span class="op">=</span><span class="va">DT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration    LogLik     wall    cpu(sec)   restrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1      -81.1114   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2      -78.833   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3      -51.7498   1:17:26      0           0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mix</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        VarComp VarCompSE     Zratio Constraint</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Year:Name:2011:2011  6.1234579  2.667732 2.29537993   Positive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Year:Name:2012:2012  0.1233875  1.247469 0.09891023   Positive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Year:Name:2013:2013  2.7438862  2.595297 1.05725337   Positive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Year:units:2011:2011 1.9291529  1.092640 1.76558852   Positive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Year:units:2012:2012 2.3721559  1.608078 1.47514977   Positive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Year:units:2013:2013 1.7597959  1.266403 1.38960184   Positive</span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co">## example to use atc() structure (level-specific)</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co"># unique(DT$Year)</span></span></span>
<span class="r-in"><span><span class="co"># mix &lt;- mmec(Yield~Env,</span></span></span>
<span class="r-in"><span><span class="co">#             random= ~ vsc(atc(Year,c("2011","2012")),isc(Name)),</span></span></span>
<span class="r-in"><span><span class="co">#             rcov=~ vsc(dsc(Year),isc(units)),</span></span></span>
<span class="r-in"><span><span class="co">#             data=DT)</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co">## example to use usc() structure (UNSTRUCTURED)</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="fu"><a href="usc.html">usc</a></span><span class="op">(</span><span class="va">DT</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28 x 3 sparse Matrix of class "dgCMatrix"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2011 2012 2013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    1    .    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20    .    1    .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28    .    .    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $thetaC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2011 2012 2013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2011    1    2    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2012    0    1    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2013    0    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.15 0.10 0.10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.10 0.15 0.10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.10 0.10 0.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span><span class="va">Env</span>,</span></span>
<span class="r-in"><span>            random<span class="op">=</span> <span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="usc.html">usc</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>,<span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            rcov<span class="op">=</span><span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="dsc.html">dsc</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>,<span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            nIters <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>            data<span class="op">=</span><span class="va">DT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration    LogLik     wall    cpu(sec)   restrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1      -80.9478   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2      -78.6609   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Updated VC is not positive definite, changing to EM step</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3      -48.1972   1:17:26      0           0</span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="co">## example using structure in fixed effect</span></span></span>
<span class="r-in"><span><span class="co">## (notice the isFixed argument)</span></span></span>
<span class="r-in"><span><span class="co">## ============================ ##</span></span></span>
<span class="r-in"><span><span class="va">mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmec.html">mmec</a></span><span class="op">(</span><span class="va">Yield</span><span class="op">~</span> <span class="fu">vsc</span><span class="op">(</span><span class="fu"><a href="atc.html">atc</a></span><span class="op">(</span><span class="va">Env</span>,<span class="st">"CA.2011"</span><span class="op">)</span>, <span class="fu"><a href="isc.html">isc</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span>, isFixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            rcov<span class="op">=</span><span class="op">~</span> <span class="va">units</span>,</span></span>
<span class="r-in"><span>            nIters<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>            data<span class="op">=</span><span class="va">DT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration    LogLik     wall    cpu(sec)   restrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1      -27.769   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2      -26.9659   1:17:26      0           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3      -26.8488   1:17:26      0           0</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/covaruber" class="external-link">Giovanny Covarrubias-Pazaran</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

